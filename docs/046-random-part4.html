<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>サンプリング分布(sampling distributions) | 江添亮のC++入門</title>
    <meta name="description" content="">
    <link rel="icon" href="64.png">
    <script>
        MathJax = {
            chtml: {
                matchFontHeight: false
            },
            tex: {
                inlineMath: [['$', '$']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="152.png">
  <meta name="msapplication-TileImage" content="/144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="assets/css/0.styles.17f32d1e.css" as="style"><link rel="preload" href="assets/js/app.8620998f.js" as="script"><link rel="preload" href="assets/js/2.7009e9ba.js" as="script"><link rel="preload" href="assets/js/51.a40bec0a.js" as="script"><link rel="prefetch" href="assets/js/10.0bc4fb9f.js"><link rel="prefetch" href="assets/js/11.c5d46ffe.js"><link rel="prefetch" href="assets/js/12.cec763ba.js"><link rel="prefetch" href="assets/js/13.85764695.js"><link rel="prefetch" href="assets/js/14.56c0c5a1.js"><link rel="prefetch" href="assets/js/15.ba58285d.js"><link rel="prefetch" href="assets/js/16.663fe3ce.js"><link rel="prefetch" href="assets/js/17.b9e53cc4.js"><link rel="prefetch" href="assets/js/18.468131c1.js"><link rel="prefetch" href="assets/js/19.966431ea.js"><link rel="prefetch" href="assets/js/20.39088cad.js"><link rel="prefetch" href="assets/js/21.f1d2fbe4.js"><link rel="prefetch" href="assets/js/22.53af9436.js"><link rel="prefetch" href="assets/js/23.45c08f75.js"><link rel="prefetch" href="assets/js/24.fec53f63.js"><link rel="prefetch" href="assets/js/25.1c55ab94.js"><link rel="prefetch" href="assets/js/26.97221aa1.js"><link rel="prefetch" href="assets/js/27.ad617385.js"><link rel="prefetch" href="assets/js/28.1d1956f2.js"><link rel="prefetch" href="assets/js/29.bb17ac3f.js"><link rel="prefetch" href="assets/js/3.a3b2b660.js"><link rel="prefetch" href="assets/js/30.3861fe0d.js"><link rel="prefetch" href="assets/js/31.93e5e7a5.js"><link rel="prefetch" href="assets/js/32.7f1f5a03.js"><link rel="prefetch" href="assets/js/33.ba1ef509.js"><link rel="prefetch" href="assets/js/34.63b70d43.js"><link rel="prefetch" href="assets/js/35.2cf21250.js"><link rel="prefetch" href="assets/js/36.93604af5.js"><link rel="prefetch" href="assets/js/37.132be8e6.js"><link rel="prefetch" href="assets/js/38.32a3f051.js"><link rel="prefetch" href="assets/js/39.bab7cf23.js"><link rel="prefetch" href="assets/js/4.3ff2fe10.js"><link rel="prefetch" href="assets/js/40.2cd9628c.js"><link rel="prefetch" href="assets/js/41.24bfe547.js"><link rel="prefetch" href="assets/js/42.39ebe085.js"><link rel="prefetch" href="assets/js/43.4ff95f43.js"><link rel="prefetch" href="assets/js/44.f1a016d7.js"><link rel="prefetch" href="assets/js/45.590d3d64.js"><link rel="prefetch" href="assets/js/46.46b99b9b.js"><link rel="prefetch" href="assets/js/47.483b5213.js"><link rel="prefetch" href="assets/js/48.65facf6a.js"><link rel="prefetch" href="assets/js/49.2bda166c.js"><link rel="prefetch" href="assets/js/5.7f8f4812.js"><link rel="prefetch" href="assets/js/50.858dc861.js"><link rel="prefetch" href="assets/js/52.f5dc4f7e.js"><link rel="prefetch" href="assets/js/53.4cfac598.js"><link rel="prefetch" href="assets/js/54.9b6224cf.js"><link rel="prefetch" href="assets/js/55.4fb7a3ba.js"><link rel="prefetch" href="assets/js/56.8a7823a6.js"><link rel="prefetch" href="assets/js/6.af1283dd.js"><link rel="prefetch" href="assets/js/7.401cafeb.js"><link rel="prefetch" href="assets/js/8.44430c93.js"><link rel="prefetch" href="assets/js/9.39e986e2.js">
    <link rel="stylesheet" href="assets/css/0.styles.17f32d1e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="index.html" class="home-link router-link-active"><!----> <span class="site-name">江添亮のC++入門</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="000-preface.html" class="sidebar-link">序</a></li><li><a href="001-intro.html" class="sidebar-link">C++の概要</a></li><li><a href="002-build.html" class="sidebar-link">C++の実行</a></li><li><a href="003-guide-to-c++.html" class="sidebar-link">C++ヒッチハイクガイド</a></li><li><a href="004-debug-compile-error.html" class="sidebar-link">デバッグ：コンパイルエラーメッセージの読み方</a></li><li><a href="005-the-restaurant-at-the-end-of-the-branch.html" class="sidebar-link">条件分岐の果てのレストラン</a></li><li><a href="006-debug-compile-warning.html" class="sidebar-link">デバッグ: コンパイル警告メッセージ</a></li><li><a href="007-standard-input.html" class="sidebar-link">最近体重が気になるあなたのための標準入力</a></li><li><a href="008-loop.html" class="sidebar-link">ループ</a></li><li><a href="009-vector.html" class="sidebar-link">メモリーを無限に確保する</a></li><li><a href="010-debug-printf.html" class="sidebar-link">デバッグ：printfデバッグ</a></li><li><a href="011-integer.html" class="sidebar-link">整数</a></li><li><a href="012-floating-point.html" class="sidebar-link">浮動小数点数</a></li><li><a href="013-names.html" class="sidebar-link">名前</a></li><li><a href="014-iterator.html" class="sidebar-link">イテレーターの基礎</a></li><li><a href="015-reference.html" class="sidebar-link">lvalueリファレンスとconst</a></li><li><a href="016-algorithm.html" class="sidebar-link">アルゴリズム</a></li><li><a href="017-lambda.html" class="sidebar-link">ラムダ式</a></li><li><a href="018-class.html" class="sidebar-link">クラスの基本</a></li><li><a href="019-operator-overloading.html" class="sidebar-link">より自然に振る舞うクラス</a></li><li><a href="020-array.html" class="sidebar-link">std::array</a></li><li><a href="021-three-virtues-of-a-programmer.html" class="sidebar-link">プログラマーの三大美徳</a></li><li><a href="022-implement-array.html" class="sidebar-link">配列</a></li><li><a href="023-template.html" class="sidebar-link">テンプレート</a></li><li><a href="024-more-array.html" class="sidebar-link">arrayをさらに実装</a></li><li><a href="025-array-iterator.html" class="sidebar-link">arrayのイテレーター</a></li><li><a href="026-exception.html" class="sidebar-link">傲慢なエラー処理: 例外</a></li><li><a href="027-pointer.html" class="sidebar-link">ポインター</a></li><li><a href="028-pointer-semantics.html" class="sidebar-link">意味上のポインター</a></li><li><a href="029-pointer-syntax.html" class="sidebar-link">文法上のポインター</a></li><li><a href="030-pointer-details.html" class="sidebar-link">ポインターの内部実装</a></li><li><a href="031-iterator-operations.html" class="sidebar-link">イテレーター詳細</a></li><li><a href="032-memory-allocation.html" class="sidebar-link">動的メモリー確保</a></li><li><a href="033-vector-implementation.html" class="sidebar-link">vectorの実装 : 基礎</a></li><li><a href="034-vector-memory-allocation.html" class="sidebar-link">vectorの実装 : メモリー確保</a></li><li><a href="035-copy.html" class="sidebar-link">コピー</a></li><li><a href="036-move.html" class="sidebar-link">ムーブ</a></li><li><a href="037-rvalue-reference.html" class="sidebar-link">rvalueリファレンス</a></li><li><a href="038-move-semantics.html" class="sidebar-link">ムーブの実装</a></li><li><a href="039-disable-copy.html" class="sidebar-link">コピーの禁止</a></li><li><a href="040-smart-pointer.html" class="sidebar-link">スマートポインター</a></li><li><a href="041-move-support.html" class="sidebar-link">自作の数値クラスで演算をムーブに対応する方法</a></li><li><a href="042-string-intro.html" class="sidebar-link">文字列</a></li><li><a href="043-random.html" class="sidebar-link">乱数</a></li><li><a href="044-random-part2.html" class="sidebar-link">ポアソン分布</a></li><li><a href="045-random-part3.html" class="sidebar-link">正規分布</a></li><li><a href="046-random-part4.html" class="active sidebar-link">サンプリング分布(sampling distributions)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="046-random-part4.html#サンプリング分布-sampling-distributions" class="sidebar-link">サンプリング分布(sampling distributions)</a></li></ul></li><li><a href="200-cpp.html" class="sidebar-link">Cプリプロセッサー</a></li><li><a href="300-multiple-source-files.html" class="sidebar-link">分割コンパイル</a></li><li><a href="400-gdb.html" class="sidebar-link">デバッガー</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="サンプリング分布-sampling-distributions"><a href="046-random-part4.html#サンプリング分布-sampling-distributions" class="header-anchor">#</a> サンプリング分布(sampling distributions)</h2> <p>サンプリング分布(sampling distributions)とは、標本から分布の特徴がわかっている場合に、その特徴を指定することにより、望みの分布を作り出す分布のことだ。</p> <h3 id="離散分布-std-discrete-distribution-inttype"><a href="046-random-part4.html#離散分布-std-discrete-distribution-inttype" class="header-anchor">#</a> 離散分布(<code>std::discrete_distribution&lt;IntType&gt;</code>)</h3> <h4 id="簡単な説明"><a href="046-random-part4.html#簡単な説明" class="header-anchor">#</a> 簡単な説明</h4> <p>離散分布(discrete distribution)は整数型の乱数$i$, $0 \leq i &lt; n$を返す分布だ。例えば$n = 10$ならば、$0,1,2,3,4,5,6,7,8,9$の10個のうちのいずれかの整数値を乱数として返す。この際、乱数値として取りうる整数値1つ1つに、確率を設定できる。確率は$p_0, \dotsc, p_{n-1}$で設定し、$p_0$が$0$の確率, $p_1$が$1$の確率...$p_{n-1}$が$n$の確率となる。それぞれの乱数$i$は確率$\frac{p_i}{S}$で出現する。このとき$S$とはすべての確率の合計、つまり$S = p_0 + \dotsc + p_{n-1}$となる。確率$p_i$は<code>double</code>型で与える。</p> <p>たとえば、<code>{1.0, 1.0, 1.0}</code>という確率群を渡した場合、離散分布は$0, 1, 2$のいずれかの乱数をそれぞれ$\frac{1.0}{3.0}$の確率で返す。</p> <p>もし、<code>{1.0, 2.0, 3.0}</code>という確率群を渡した場合、離散分布は$0, 1, 2$のいずれかの乱数を返す。その時の確率は、$1$が$\frac{1}{6}$、$2$が$\frac{1}{3}$、$3$が$\frac{1}{2}$だ。</p> <p>例えば公平な6面ダイスを作りたい場合、<code>{1.0, 1.0, 1.0, 1.0, 1.0, 1.0}</code>を指定すると$0 \leq i \leq 5$までの6個の乱数$i$がそれぞれ$\frac{1}{6}$の確率で生成される。この結果に<code>+1</code>すると$1 \leq i \leq 6$の乱数を得ることができる。</p> <p>6の目だけ2倍高い確率で出るイカサマ6面ダイスを作りたい場合、<code>{1.0, 1.0, 1.0, 1.0, 1.0, 2.0}</code>を指定すると、0から4までの5つの目は$\frac{1}{7}$の確率で出現し、5だけは$\frac{2}{7}$の確率で出る乱数を作ることができる。</p> <p>$S$はすべての確率の合計で、それぞれの値は$\frac{p_i}{S}$の確率で出る。なので、以下はすべて分布だ。</p> <div class="language- extra-class"><pre class="language-text"><code>{1.0, 1.0, 1.0, 1.0, 1.0, 2.0}
{0.1, 0.1, 0.1, 0.1, 0.1, 0.2}
{2.0, 2.0, 2.0, 2.0, 2.0, 4.0}
</code></pre></div><h4 id="数学的な説明"><a href="046-random-part4.html#数学的な説明" class="header-anchor">#</a> 数学的な説明</h4> <p><code>std::discrete_distribution&lt;IntType&gt;</code>は整数型の乱数$i$, $0 \leq i &lt; n$を以下の離散確率関数に従って分布する。</p> <p>$$
P(i ,|, p_0, \dotsc, p_{n-1}) = p_i \text{ .}
$$</p> <p>別に指定のない場合、分布パラメーターは$p_k = {w_k / S}$ for $k = 0, \dotsc, n - 1$として計算され、このとき値$w_k$は、一般に*ウエイト（weight）*と呼ばれていて、値は非負数、非NaN、非無限でなければならない。さらに、以下の関係が成り立たねばならない。$0 &lt; S = w_0 + \dotsb + w_{n - 1}$。</p> <h4 id="変数の宣言"><a href="046-random-part4.html#変数の宣言" class="header-anchor">#</a> 変数の宣言</h4> <p><code>std::discrete_distribution</code>の変数を宣言するには3つの方法がある。いずれも<code>double</code>型の値を<code>n</code>個渡すための方法だ。</p> <h5 id="イテレーターのペア"><a href="046-random-part4.html#イテレーターのペア" class="header-anchor">#</a> イテレーターのペア</h5> <p>変数の宣言:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token operator">::</span>discrete_distribution<span class="token operator">&lt;</span>IntType<span class="token operator">&gt;</span> <span class="token function">d</span><span class="token punctuation">(</span> firstW<span class="token punctuation">,</span> lastW <span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p><code>IntType</code>は整数型でデフォルトは<code>int</code>、<code>[firstW, lastW)</code>はイテレーターのペアで、<code>double</code>型に変換可能な値を参照している。</p> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>array ps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>discrete_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>mt19937 e <span class="token punctuation">;</span>
    <span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="初期化リスト"><a href="046-random-part4.html#初期化リスト" class="header-anchor">#</a> 初期化リスト</h5> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token operator">::</span>discrete_distribution<span class="token operator">&lt;</span>IntType<span class="token operator">&gt;</span> <span class="token function">d</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
std<span class="token operator">::</span>discrete_distribution<span class="token operator">&lt;</span>IntType<span class="token operator">&gt;</span> d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
</code></pre></div><p><code>...</code>には<code>double</code>型の浮動小数点数を指定する</p> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>discrete_distribution <span class="token function">d</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// もしくは</span>
    <span class="token comment">// ... d = { 1.0, 2.0, 3.0 } ;</span>

    std<span class="token operator">::</span>mt19937 e <span class="token punctuation">;</span>
    <span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="個数、デルタ、関数"><a href="046-random-part4.html#個数、デルタ、関数" class="header-anchor">#</a> 個数、デルタ、関数</h5> <p>このコンストラクターは以下のように宣言されている。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UnaryOperation</span><span class="token operator">&gt;</span>
    <span class="token function">discrete_distribution</span><span class="token punctuation">(</span>
        size_t nw<span class="token punctuation">,</span>
        <span class="token keyword">double</span> xmin<span class="token punctuation">,</span> <span class="token keyword">double</span> xmax<span class="token punctuation">,</span>
        UnaryOperation fw
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>UnaryOperation</code>は1つの実引数を取る関数オブジェクトで戻り値の型は<code>double</code>型に変換できること。さらに、<code>double</code>型は<code>UnaryOperation</code>の引数に変換可能なこと。もし$nw = 0$の場合は、$n = 1$とする。それ以外の場合、$n = \tcode{nw}$とする。このとき、$0 &lt; \delta = (\tcode{xmax} - \tcode{xmin}) / n$となる関係が満たされなければならない。</p> <p>もし$nw = 0$ならば$w_0 = 1$。それ以外の場合、$k = 0, \dotsc, n - 1$に対して、$w_k = \tcode{fw}(\tcode{xmin} + k \cdot \delta + \delta / 2)$とする。<code>fw</code>は<code>n</code>回を超えて呼ばれることはない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>discrete_distribution <span class="token function">d</span><span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> <span class="token string">'\n'</span> <span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">&lt;</span> <span class="token number">0.3</span> <span class="token punctuation">)</span>
            x <span class="token operator">=</span> <span class="token number">0.3</span> <span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">&gt;</span> <span class="token number">0.8</span> <span class="token punctuation">)</span>
            x <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token punctuation">;</span>
        <span class="token keyword">return</span> x <span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>この<code>d</code>は、</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token operator">::</span>discrete_distribution d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.8</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
</code></pre></div><p>と初期化されたものと同じように初期化される。</p> <h4 id="初期化パラメーターの確認"><a href="046-random-part4.html#初期化パラメーターの確認" class="header-anchor">#</a> 初期化パラメーターの確認</h4> <p><code>std::discrete_distribution</code>の内部状態はメンバー関数<code>probabilities</code>で取得できる。戻り値の型は<code>std::vector&lt;double&gt;</code>で、指定した確率群が要素になっている。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>discrete_distribution d <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> v <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">probabilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// vは{1.0, 2.0, 3.0}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="応用例"><a href="046-random-part4.html#応用例" class="header-anchor">#</a> 応用例</h4> <p>以下は6の目が2倍の確率で出るイカサマ6面ダイスの実装だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span> <span class="token keyword">typename</span> Engine <span class="token operator">&gt;</span>
<span class="token keyword">int</span> <span class="token function">roll_dice</span><span class="token punctuation">(</span> Engine <span class="token operator">&amp;</span> e <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>discrete_distribution d <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="区分定数分布-std-piecewise-constant-distribution-realtype"><a href="046-random-part4.html#区分定数分布-std-piecewise-constant-distribution-realtype" class="header-anchor">#</a> 区分定数分布(<code>std::piecewise_constant_distribution&lt;RealType&gt;</code>)</h3> <h4 id="簡単な説明-2"><a href="046-random-part4.html#簡単な説明-2" class="header-anchor">#</a> 簡単な説明</h4> <p>区分定数分布(piecewise constant distribution)とは、区分と、区分ごとの確率を指定し、いずれかの区分の範囲の値に一様分布させる分布だ。ここでいう確率は、密度、あるいはウエイトともいう。</p> <p>1つの区分は<code>double</code>型の値2つ$b_i, b_{i+1}$で与える。このとき区分の乱数$x$の範囲は$[b_i, b_{i+1})$、もしくは$b_i \leq x &lt; b_{i+1}$だ。$n$個の値を指定すると、$n-1$個の区分を指定したことになる。</p> <p>例えば<code>{0.0, 1.0}</code>という2つの<code>double</code>型の値を使って1つの区分を与えた場合、これは$0.0 \leq x &lt; 1.0$という値の範囲の区分である。<code>{0.0, 1.0, 2.0}</code>という3つの<code>double</code>型の値は2つの区分になり、それぞれ$0.0 \leq x &lt; 1.0$, $1.0 \leq x &lt; 2.0$になる。</p> <p>一般に、$n$個の<code>double</code>型の値$b_0, \dotsc, b_n$で$n-1$個の区分を表現する。このとき、$b_i &lt; b_{i+1}$が$i = 0, \dotsc, n-1$までの$i$について成り立たなければならない。つまり区分を指定する<code>double</code>型の値は、後続の値より小さくなければならないということだ。</p> <p>以下は正しい区分の指定だ。</p> <div class="language- extra-class"><pre class="language-text"><code>{1.0, 2.0, 100.0, 999.999}
{-1.0, 1.0, 2.0}
{-5.0, -4.0, -3.1}
</code></pre></div><p>以下は正しくない区分の指定だ。</p> <div class="language- extra-class"><pre class="language-text"><code>{1.0, 0.0}
</code></pre></div><p>これは$b_0 &gt; b_1$なので正しくない。</p> <p>それぞれの区分$[b_i, b_{i+1})$に対して確率$p_i$を<code>double</code>型で指定する。$n$個の$b_i$によって$n-1$個の区分を指定し、それぞれに対して1つずつ確率を設定するので、確率の数は$n-1$個だ。</p> <p>例えば<code>{0.0, 1.0}</code>という1つの区分と<code>{1.0}</code>という1つの確率を与えた場合、$0.0 \leq x &lt; 1.0$の範囲の乱数$x$が生成される。</p> <p><code>{0.0, 1.0, 10.0}</code>という2つの区分と、<code>{1.0, 2.0}</code>という2つの確率を与えた場合、$\frac{1}{3}$の確率で$0.0 \leq x &lt; 1.0$の範囲に一様分布した乱数になり、$\frac{2}{3}$の確率で$1.0 \leq x &lt; 10.0$の範囲に一様分布した乱数になる。</p> <h4 id="数学的な説明-2"><a href="046-random-part4.html#数学的な説明-2" class="header-anchor">#</a> 数学的な説明</h4> <p><code>std::piecewise_constant_distribution&lt;RealType&gt;</code>は浮動小数点数型の乱数$x$, $b_0 \leq x &lt; b_n$を以下の確率密度関数に従って、それぞれの部分区間(subinterval)$[b_i, b_{i+1})$の間で一様に分布させる。</p> <p>$$
p(x ,|, b_0, \dotsc, b_n, ; \rho_0, \dotsc, \rho_{n-1}) = \rho_i
\text{ , for $b_i \le x &lt; b_{i+1}$.}
$$</p> <p>この分布の区間境界(interval boundaries)ともいう$n+1$分布パラメーター$b_i$はすべての$i = 0, \dotsc, n - 1$に対して関係$b_i &lt; b_{i + 1}$を満たさねばならない。別途指定なき場合、残りの$n$分布パラメーターは以下のように計算される。</p> <p>$$
\rho_k = \frac{w_k}{S \cdot (b_{k+1}-b_k)} \text{ for } k = 0, \dotsc, n - 1 \text{ ,}
$$</p> <p>一般にウエイト(weight)と呼ばれている値$w_k$は、非負数、非NaN、非無限でなければならない。さらに、以下の関係を満たさなければならない。</p> <p>$0 &lt; S = w_0 + \dotsb + w_{n-1}$</p> <h4 id="変数の宣言-2"><a href="046-random-part4.html#変数の宣言-2" class="header-anchor">#</a> 変数の宣言</h4> <p><code>std::piecewise_constant_distribution</code>では、<code>double</code>型の値の集合を2つ渡す必要がある。1つは区間を指定するための$N$個の<code>double</code>型に変換可能な値で、もう1つは区間ごとの確率を指定するための$N-1$個の<code>double</code>型に変換可能な値だ。</p> <h5 id="イテレーターによる指定"><a href="046-random-part4.html#イテレーターによる指定" class="header-anchor">#</a> イテレーターによる指定</h5> <p>イテレーターで区間と確率を指定するコンストラクターは以下のとおり。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">InputIteratorB</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">InputIteratorW</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_constant_distribution</span><span class="token punctuation">(</span>
    InputIteratorB firstB<span class="token punctuation">,</span> InputIteratorB lastB<span class="token punctuation">,</span>
    InputIteratorW firstW
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>[firstB, lastB)</code>は区間を指定するための$N$個の値を参照する入力イテレーターのペアだ。<code>firstW</code>はそれぞれの区間の確率を指定する$N-1$個の値を参照する入力イテレーターの先頭だ。<code>lastW</code>がないのは、確率の個数は$N-1$個であるとわかっているからだ。</p> <p>もし<code>[firstB, lastB)</code>のサイズが1以下の場合、区間は<code>[0.0, 1.0)</code>になり、確率は$\frac{1}{1}$になる。</p> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>array bs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>array ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_constant_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>

    std<span class="token operator">::</span>mt19937 e <span class="token punctuation">;</span>
    <span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>bs</code>は区間を指定する値の集合、<code>ps</code>は区間ごとの確率だ。</p> <p>区間は<code>[-1.0, 1.0)</code>と<code>[1.0, 2.0)</code>の2つ。確率はそれぞれ$\frac{1}{6}$、$\frac{5}{6}$だ。</p> <p>区間を表現する値が足りない場合は以下のとおり。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 区間を指定すべき値が足りない</span>
    std<span class="token operator">::</span>array bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>array ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token comment">// 引数は無視される。</span>
    <span class="token comment">// 区間は[0.0, 1.0), 確率は100%</span>
    std<span class="token operator">::</span>piecewise_constant_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="初期化リストと関数オブジェクトによる指定"><a href="046-random-part4.html#初期化リストと関数オブジェクトによる指定" class="header-anchor">#</a> 初期化リストと関数オブジェクトによる指定</h5> <p>初期化リストと関数を指定するコンストラクターは以下のとおり。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UnaryOperation</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_constant_distribution</span><span class="token punctuation">(</span>
    initializer_list<span class="token operator">&lt;</span>RealType<span class="token operator">&gt;</span> bl<span class="token punctuation">,</span>
    UnaryOperation fw
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>イテレーターのペアと同じく、区間は<code>[bl.begin(), bl.end())</code>で指定する。</p> <p>確率は$k = 0, \dotsc, n - 1$について、$w_k = \tcode{fw}\bigl(\bigl(b_{k+1} + b_k\bigr) / 2\bigr)$とする。</p> <p><code>bl.size()</code>が1以下の場合、区間は<code>[0.0, 1.0)</code>になり、確率は$\frac{1}{1}$になる。</p> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>piecewise_constant_distribution <span class="token function">d</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">auto</span> x <span class="token punctuation">)</span>
        <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>この場合、区間は<code>[1.0, 2.0)</code>, <code>[2.0, 3.0)</code>, <code>[3.0, 4.0)</code>, <code>[4.0, 5.0)</code>の4個になり、確率は<code>{1.5, 2.5, 3.5, 4.5}</code>となる。</p> <h5 id="区間数、最小、最大、関数オブジェクトによる指定"><a href="046-random-part4.html#区間数、最小、最大、関数オブジェクトによる指定" class="header-anchor">#</a> 区間数、最小、最大、関数オブジェクトによる指定</h5> <p>コンストラクターの宣言:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UnaryOperation</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_constant_distribution</span><span class="token punctuation">(</span>
    size_t nw<span class="token punctuation">,</span>
    RealType xmin<span class="token punctuation">,</span> RealType xmax<span class="token punctuation">,</span>
    UnaryOperation fw
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>nw</code>は区間数、<code>xmin</code>は最小値、<code>xmax</code>は最大値、<code>fw</code>は関数オブジェクトで、<code>double</code>型から変換できる型の実引数を取り、<code>double</code>型に変換可能な戻り値を返す。</p> <p>$nw = 0$の場合、区間の個数$n$は$1$になる。それ以外の場合、$n = nw$となる。このとき関係、$0 &lt; \delta = (\tcode{xmax} - \tcode{xmin}) / n$が成り立たなければならない。
Let $b_k = \tcode{xmin} + k \cdot \delta $ for $ k = 0, \dotsc, n$,
and $w_k = \tcode{fw}(b_k + \delta / 2) $ for .</p> <p>$ k = 0, \dotsc, n - 1$において、区間は$b_k = \tcode{xmin} + k \cdot \delta $ for $ k = 0, \dotsc, n$とし、確率は$w_k = \tcode{fw}(b_k + \delta / 2) $とする。</p> <p>利用例:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>piecewise_constant_distribution <span class="token function">d</span><span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">auto</span> x <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>この場合、区間の集合は<code>{1.0, 1.8, 2.6, 3.4, 4.2, 5.0}</code>となり、確率は<code>{1.4, 2.2, 3.0, 3.8, 4.6}</code>となる。</p> <h4 id="内部状態の取得"><a href="046-random-part4.html#内部状態の取得" class="header-anchor">#</a> 内部状態の取得</h4> <p><code>std::piecewise_constant_distribution</code>の内部状態は、メンバー関数<code>intervals</code>と<code>densities</code>で得ることができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">RealType</span> <span class="token operator">=</span> <span class="token keyword">double</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">piecewise_constant_distribution</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token operator">:</span>
    vector<span class="token operator">&lt;</span>result_type<span class="token operator">&gt;</span> <span class="token function">intervals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>result_type<span class="token operator">&gt;</span> <span class="token function">densities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span>
</code></pre></div><p><code>intervals</code>は区間、<code>densities</code>は確率を返す。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_constant_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token comment">// {1.0, 2.0, 3.0}</span>
    <span class="token keyword">auto</span> intervals <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">intervals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// {0.333333, 0.666667}</span>
    <span class="token keyword">auto</span> densities <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">densities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>densities()</code>の結果が正規化されているのは、ユーザーが指定した確率は$w_k$だが、ここで返すのは$p_k$だからだ。</p> <h3 id="区分線形分布-std-piecewise-linear-distribution-realtype"><a href="046-random-part4.html#区分線形分布-std-piecewise-linear-distribution-realtype" class="header-anchor">#</a> 区分線形分布(<code>std::piecewise_linear_distribution&lt;RealType&gt;</code>)</h3> <h4 id="簡単な説明-3"><a href="046-random-part4.html#簡単な説明-3" class="header-anchor">#</a> 簡単な説明</h4> <p>区分線形分布(piecewise linear distribution)は区分定数分布と同じく、区間と確率（またの名を密度、ウエイト）を指定する。</p> <p>区間の指定は区分定数分布と同じだ。内部境界の集合で指定する。例えば<code>{1.0, 2.0, 3.0}</code>は2つの区間<code>[1.0, 2.0)</code>と<code>[2.0, 3.0)</code>を指定する。</p> <p>区分線形分布における確率は、区間に対してではなく、内部境界に対して指定する。指定した全区間における値の出現確率は、内部境界から内部境界に向かって指定した確率の差の方向に線形に増加、もしくは減少する。</p> <p>例えば区分<code>{0.0, 1.0}</code>と確率<code>{1.0, 2.0}</code>を指定した場合、これは1つの区間<code>[0.0, 1.0)</code>について、内部境界<code>0.0</code>の確率は$\frac{1}{3}$、内部境界<code>1.0</code>の確率は<code>\frac{2}{3}</code>とし、$0.0 \leq x &lt; 1.0$の範囲の乱数<code>x</code>を生成する。内部境界区間の範囲に注意。<code>1.0</code>未満なので、<code>1.0</code>は出ない。</p> <p>そして、区間の間の値は、区間を区切る2つの内部境界の確率の差によって、線形に増加、もしくは減少する。例えば値<code>0.25</code>が出る確率は$\frac{1.25}{3}$、<code>0.5</code>が出る確率は$\frac{1.5}{3}$、値<code>1.75</code>が出る確率は$\frac{1.75}{3}$だ。</p> <p>区分<code>{0.0, 1.0, 2.0}</code>と確率<code>{1.0, 2.0, 1.0}</code>の場合、2つの区間<code>[0.0, 1.0)</code>と<code>[1.0, 2.0)</code>の範囲について、<code>0.0</code>から<code>1.0</code>に向かう区間についての確率は$\frac{1}{4}$から$\frac{1}{2}$に増加し、<code>1.0</code>から<code>2.0</code>に向かう区間についての確率は$\frac{1}{2}$から$\frac{1}{4}$に減少する。</p> <p>結果として、乱数値の分布をグラフに描画すると、<code>1.0</code>が最も出やすく、その前後±1.0の範囲で徐々に減少していく山のようなグラフになる。</p> <p>TODO: グラフ、横軸が乱数値、縦軸が確率</p> <div class="language- extra-class"><pre class="language-text"><code>      *       + \frac{1}{2}
     ***      |
    *****     |
   *******    |
  *********   |
 ***********  + \frac{1}{4}
 ***********
 ***********
 ***********
 ***********
-+----+----+
0.0  1.0  2.0
</code></pre></div><p>fig/fig39-01.png</p> <h4 id="数学的な説明-3"><a href="046-random-part4.html#数学的な説明-3" class="header-anchor">#</a> 数学的な説明</h4> <p><code>std::piecewise_linear_distribution&lt;RealType&gt;</code>は乱数$x$, $b_0 \leq x &lt; b_n$を以下の確率密度関数に従って分布する。</p> <p>$$
p(x ,|, b_0, \dotsc, b_n, ; \rho_0, \dotsc, \rho_n)
= \rho_{i}   \cdot {\frac{b_{i+1} - x}{b_{i+1} - b_i}}
+ \rho_{i+1} \cdot {\frac{x - b_i}{b_{i+1} - b_i}}
\text{ , for $b_i \le x &lt; b_{i+1}$.}
$$</p> <p>一般に<em>内部境界</em>とも呼ばれる$n + 1$分布パラメーター$b_i$は$i = 0, \dotsc, n - 1$において関係$b_i &lt; b_{i+1}$ for $i = 0, \dotsc, n - 1$を満たさねばならない。別記する場合を除いて、残りの$n + 1$パラメーターは$k = 0, \dotsc, n$において$\rho_k = {w_k / S}$と計算される。このとき$w_k$は一般に境界におけるウエイト(weight at boundaries)と呼ばれ、非負数、非NaN、非無限でなければならない。さらに、以下の関係が成り立たねばならない。</p> <p>$$
0 &lt; S = \frac{1}{2} \cdot \sum_{k=0}^{n-1} (w_k + w_{k+1}) \cdot (b_{k+1} - b_k) \text{ .}
$$</p> <h4 id="変数の宣言-3"><a href="046-random-part4.html#変数の宣言-3" class="header-anchor">#</a> 変数の宣言</h4> <p><code>piecewise_linear_distribution</code>は区間と確率を指定するために<code>n</code>個の<code>double</code>型に変換可能な値を指定する必要がある。</p> <h5 id="イテレーターによる指定-2"><a href="046-random-part4.html#イテレーターによる指定-2" class="header-anchor">#</a> イテレーターによる指定</h5> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">InputIteratorB</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">InputIteratorW</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_linear_distribution</span><span class="token punctuation">(</span>
    InputIteratorB firstB<span class="token punctuation">,</span> InputIteratorB lastB<span class="token punctuation">,</span>
    InputIteratorW firstW <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>[firstB, lastB)</code>は区間、<code>firstW</code>から区間数までのイテレーターが確率。</p> <p><code>firstB == lastB</code>もしくは<code>++firstB == lastB</code>の場合、つまり内部境界が1個以下で、空の場合、区間数は1つで<code>[0.0, 1.0)</code>の範囲、確率は<code>{0.0, 1.0}</code>となる。</p> <p>使い方:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>

    std<span class="token operator">::</span>mt19937 e <span class="token punctuation">;</span>
    <span class="token function">d</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>空の場合。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは以下のコードと同じだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="初期化リストと関数オブジェクトによる指定-2"><a href="046-random-part4.html#初期化リストと関数オブジェクトによる指定-2" class="header-anchor">#</a> 初期化リストと関数オブジェクトによる指定</h5> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UnaryOperation</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_linear_distribution</span><span class="token punctuation">(</span>
    initializer_list<span class="token operator">&lt;</span>RealType<span class="token operator">&gt;</span> bl<span class="token punctuation">,</span>
    UnaryOperation fw
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>区間を指定する内部境界は<code>[bl.begin(), bl.end())</code>、内部境界$b_k$に対する確率$w_k$は$k = 0, \dotsc, n$について、$w_k = \tcode{fw}(b_k)$とする。</p> <p>内部境界が1個以下の場合はイテレーターの場合と同じ。</p> <p>使い方:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは以下のコード同じだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> bs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="個数、最小値、最大値、関数オブジェクトによる指定"><a href="046-random-part4.html#個数、最小値、最大値、関数オブジェクトによる指定" class="header-anchor">#</a> 個数、最小値、最大値、関数オブジェクトによる指定</h5> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">UnaryOperation</span><span class="token operator">&gt;</span>
<span class="token function">piecewise_linear_distribution</span><span class="token punctuation">(</span>
    size_t nw<span class="token punctuation">,</span>
    RealType xmin<span class="token punctuation">,</span> RealType xmax<span class="token punctuation">,</span>
    UnaryOperation fw
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>nw</code>が個数、<code>xmin</code>が最小値、<code>xmax</code>が最大値、<code>fw</code>が関数オブジェクト。</p> <p>関数オブジェクト<code>fw</code>は<code>double</code>型から変換できる実引数を1つだけ取り、戻り値の型は<code>double</code>型に変換できること。</p> <p>$\tcode{nw} = 0$ならば空であり、イテレーターの場合と同じ。</p> <p>関係$0 &lt; \delta = (\tcode{xmax} - \tcode{xmin}) / n$が成り立つこと。</p> <p>内部境界$b_k$は$k = 0, \dotsc, n$について$b_k = \tcode{xmin} + k \cdot \delta$とする。確率$w_k$は$k = 0, \dotsc, n$について$w_k = \tcode{fw}(b_k)$とする。</p> <p>使い方:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span>
        <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上のコードは以下のコードと同じだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> params <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">2.6</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">5.8</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>piecewise_linear_distribution <span class="token function">d</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="045-random-part3.html" class="prev">正規分布</a></span> <span class="next"><a href="200-cpp.html">Cプリプロセッサー</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="assets/js/app.8620998f.js" defer></script><script src="assets/js/2.7009e9ba.js" defer></script><script src="assets/js/51.a40bec0a.js" defer></script>
  </body>
</html>
