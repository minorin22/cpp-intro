<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>イテレーターの基礎 | 江添亮のC++入門</title>
    <meta name="description" content="">
    <link rel="icon" href="64.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="152.png">
  <meta name="msapplication-TileImage" content="/144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="assets/css/0.styles.17f32d1e.css" as="style"><link rel="preload" href="assets/js/app.8620998f.js" as="script"><link rel="preload" href="assets/js/2.7009e9ba.js" as="script"><link rel="preload" href="assets/js/19.966431ea.js" as="script"><link rel="prefetch" href="assets/js/10.0bc4fb9f.js"><link rel="prefetch" href="assets/js/11.c5d46ffe.js"><link rel="prefetch" href="assets/js/12.cec763ba.js"><link rel="prefetch" href="assets/js/13.85764695.js"><link rel="prefetch" href="assets/js/14.56c0c5a1.js"><link rel="prefetch" href="assets/js/15.ba58285d.js"><link rel="prefetch" href="assets/js/16.663fe3ce.js"><link rel="prefetch" href="assets/js/17.b9e53cc4.js"><link rel="prefetch" href="assets/js/18.468131c1.js"><link rel="prefetch" href="assets/js/20.39088cad.js"><link rel="prefetch" href="assets/js/21.f1d2fbe4.js"><link rel="prefetch" href="assets/js/22.53af9436.js"><link rel="prefetch" href="assets/js/23.45c08f75.js"><link rel="prefetch" href="assets/js/24.fec53f63.js"><link rel="prefetch" href="assets/js/25.1c55ab94.js"><link rel="prefetch" href="assets/js/26.97221aa1.js"><link rel="prefetch" href="assets/js/27.ad617385.js"><link rel="prefetch" href="assets/js/28.1d1956f2.js"><link rel="prefetch" href="assets/js/29.bb17ac3f.js"><link rel="prefetch" href="assets/js/3.a3b2b660.js"><link rel="prefetch" href="assets/js/30.3861fe0d.js"><link rel="prefetch" href="assets/js/31.93e5e7a5.js"><link rel="prefetch" href="assets/js/32.7f1f5a03.js"><link rel="prefetch" href="assets/js/33.ba1ef509.js"><link rel="prefetch" href="assets/js/34.63b70d43.js"><link rel="prefetch" href="assets/js/35.2cf21250.js"><link rel="prefetch" href="assets/js/36.93604af5.js"><link rel="prefetch" href="assets/js/37.132be8e6.js"><link rel="prefetch" href="assets/js/38.32a3f051.js"><link rel="prefetch" href="assets/js/39.bab7cf23.js"><link rel="prefetch" href="assets/js/4.3ff2fe10.js"><link rel="prefetch" href="assets/js/40.2cd9628c.js"><link rel="prefetch" href="assets/js/41.24bfe547.js"><link rel="prefetch" href="assets/js/42.39ebe085.js"><link rel="prefetch" href="assets/js/43.4ff95f43.js"><link rel="prefetch" href="assets/js/44.f1a016d7.js"><link rel="prefetch" href="assets/js/45.590d3d64.js"><link rel="prefetch" href="assets/js/46.46b99b9b.js"><link rel="prefetch" href="assets/js/47.483b5213.js"><link rel="prefetch" href="assets/js/48.65facf6a.js"><link rel="prefetch" href="assets/js/49.2bda166c.js"><link rel="prefetch" href="assets/js/5.7f8f4812.js"><link rel="prefetch" href="assets/js/50.858dc861.js"><link rel="prefetch" href="assets/js/51.a40bec0a.js"><link rel="prefetch" href="assets/js/52.f5dc4f7e.js"><link rel="prefetch" href="assets/js/53.4cfac598.js"><link rel="prefetch" href="assets/js/54.9b6224cf.js"><link rel="prefetch" href="assets/js/55.4fb7a3ba.js"><link rel="prefetch" href="assets/js/56.8a7823a6.js"><link rel="prefetch" href="assets/js/6.af1283dd.js"><link rel="prefetch" href="assets/js/7.401cafeb.js"><link rel="prefetch" href="assets/js/8.44430c93.js"><link rel="prefetch" href="assets/js/9.39e986e2.js">
    <link rel="stylesheet" href="assets/css/0.styles.17f32d1e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="index.html" class="home-link router-link-active"><!----> <span class="site-name">江添亮のC++入門</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="000-preface.html" class="sidebar-link">序</a></li><li><a href="001-intro.html" class="sidebar-link">C++の概要</a></li><li><a href="002-build.html" class="sidebar-link">C++の実行</a></li><li><a href="003-guide-to-c++.html" class="sidebar-link">C++ヒッチハイクガイド</a></li><li><a href="004-debug-compile-error.html" class="sidebar-link">デバッグ：コンパイルエラーメッセージの読み方</a></li><li><a href="005-the-restaurant-at-the-end-of-the-branch.html" class="sidebar-link">条件分岐の果てのレストラン</a></li><li><a href="006-debug-compile-warning.html" class="sidebar-link">デバッグ: コンパイル警告メッセージ</a></li><li><a href="007-standard-input.html" class="sidebar-link">最近体重が気になるあなたのための標準入力</a></li><li><a href="008-loop.html" class="sidebar-link">ループ</a></li><li><a href="009-vector.html" class="sidebar-link">メモリーを無限に確保する</a></li><li><a href="010-debug-printf.html" class="sidebar-link">デバッグ：printfデバッグ</a></li><li><a href="011-integer.html" class="sidebar-link">整数</a></li><li><a href="012-floating-point.html" class="sidebar-link">浮動小数点数</a></li><li><a href="013-names.html" class="sidebar-link">名前</a></li><li><a href="014-iterator.html" class="active sidebar-link">イテレーターの基礎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="014-iterator.html#イテレーターの取得方法" class="sidebar-link">イテレーターの取得方法</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#イテレーターの参照する要素に対する読み書き" class="sidebar-link">イテレーターの参照する要素に対する読み書き</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#イテレーターの参照する要素を変更" class="sidebar-link">イテレーターの参照する要素を変更</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#イテレーターの比較" class="sidebar-link">イテレーターの比較</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#最後の次の要素へのイテレーター" class="sidebar-link">最後の次の要素へのイテレーター</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#なんでもイテレーター" class="sidebar-link">なんでもイテレーター</a></li><li class="sidebar-sub-header"><a href="014-iterator.html#イテレーターと添字の範囲" class="sidebar-link">イテレーターと添字の範囲</a></li></ul></li><li><a href="015-reference.html" class="sidebar-link">lvalueリファレンスとconst</a></li><li><a href="016-algorithm.html" class="sidebar-link">アルゴリズム</a></li><li><a href="017-lambda.html" class="sidebar-link">ラムダ式</a></li><li><a href="018-class.html" class="sidebar-link">クラスの基本</a></li><li><a href="019-operator-overloading.html" class="sidebar-link">より自然に振る舞うクラス</a></li><li><a href="020-array.html" class="sidebar-link">std::array</a></li><li><a href="021-three-virtues-of-a-programmer.html" class="sidebar-link">プログラマーの三大美徳</a></li><li><a href="022-implement-array.html" class="sidebar-link">配列</a></li><li><a href="023-template.html" class="sidebar-link">テンプレート</a></li><li><a href="024-more-array.html" class="sidebar-link">arrayをさらに実装</a></li><li><a href="025-array-iterator.html" class="sidebar-link">arrayのイテレーター</a></li><li><a href="026-exception.html" class="sidebar-link">傲慢なエラー処理: 例外</a></li><li><a href="027-pointer.html" class="sidebar-link">ポインター</a></li><li><a href="028-pointer-semantics.html" class="sidebar-link">意味上のポインター</a></li><li><a href="029-pointer-syntax.html" class="sidebar-link">文法上のポインター</a></li><li><a href="030-pointer-details.html" class="sidebar-link">ポインターの内部実装</a></li><li><a href="031-iterator-operations.html" class="sidebar-link">イテレーター詳細</a></li><li><a href="032-memory-allocation.html" class="sidebar-link">動的メモリー確保</a></li><li><a href="033-vector-implementation.html" class="sidebar-link">vectorの実装 : 基礎</a></li><li><a href="034-vector-memory-allocation.html" class="sidebar-link">vectorの実装 : メモリー確保</a></li><li><a href="035-copy.html" class="sidebar-link">コピー</a></li><li><a href="036-move.html" class="sidebar-link">ムーブ</a></li><li><a href="037-rvalue-reference.html" class="sidebar-link">rvalueリファレンス</a></li><li><a href="038-move-semantics.html" class="sidebar-link">ムーブの実装</a></li><li><a href="039-disable-copy.html" class="sidebar-link">コピーの禁止</a></li><li><a href="040-smart-pointer.html" class="sidebar-link">スマートポインター</a></li><li><a href="041-move-support.html" class="sidebar-link">自作の数値クラスで演算をムーブに対応する方法</a></li><li><a href="042-string-intro.html" class="sidebar-link">文字列</a></li><li><a href="043-random.html" class="sidebar-link">乱数</a></li><li><a href="044-random-part2.html" class="sidebar-link">ポアソン分布</a></li><li><a href="045-random-part3.html" class="sidebar-link">正規分布</a></li><li><a href="046-random-part4.html" class="sidebar-link">サンプリング分布(sampling distributions)</a></li><li><a href="200-cpp.html" class="sidebar-link">Cプリプロセッサー</a></li><li><a href="300-multiple-source-files.html" class="sidebar-link">分割コンパイル</a></li><li><a href="400-gdb.html" class="sidebar-link">デバッガー</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="イテレーターの基礎"><a href="014-iterator.html#イテレーターの基礎" class="header-anchor">#</a> イテレーターの基礎</h1> <p><code>vector</code>の章では<code>vector</code>の要素にアクセスする方法としてメンバー関数<code>at(i)</code>を学んだ。<code>at(i)</code>は<code>i</code>番目の要素にアクセスできる。ただし最初の要素は0番目だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">int</span> x <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 3</span>
    v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token comment">// vは{1,2,0,4,5}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>この章では<code>vector</code>の要素にアクセスする方法としてイテレーター(iterator)を学ぶ。</p> <h2 id="イテレーターの取得方法"><a href="014-iterator.html#イテレーターの取得方法" class="header-anchor">#</a> イテレーターの取得方法</h2> <p>イテレーターは<code>std::begin(v)</code>で取得する。<code>v</code>は<code>vector</code>の変数だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="イテレーターの参照する要素に対する読み書き"><a href="014-iterator.html#イテレーターの参照する要素に対する読み書き" class="header-anchor">#</a> イテレーターの参照する要素に対する読み書き</h2> <p>イテレーターは<code>vector</code>の先頭の要素を指し示している。イテレーターの指し示す要素を参照するには<code>*</code>を使う。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 1</span>

    <span class="token operator">*</span>i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token comment">// vは{0,2,3,4,5} </span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>*i</code>を読み込むと指し示す要素の値を読むことができ、<code>*i</code>に代入をすると指し示す要素の値を変えることができる。</p> <h2 id="イテレーターの参照する要素を変更"><a href="014-iterator.html#イテレーターの参照する要素を変更" class="header-anchor">#</a> イテレーターの参照する要素を変更</h2> <p>現在指している要素の次の要素を指すように変更するには<code>++</code>を使う。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 2</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>現在指している要素の前の要素を指すように変更するには<code>--</code>を使う。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 2</span>
    <span class="token operator">--</span>i <span class="token punctuation">;</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>vector</code>の全要素を先頭からイテレーターでアクセスするには、要素数だけ<code>++i</code>すればよいことになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> iter <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span> std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">!=</span> std<span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>iter <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>iter <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは動く。ただしもっとマシな方法がある。イテレーターの比較だ。</p> <h2 id="イテレーターの比較"><a href="014-iterator.html#イテレーターの比較" class="header-anchor">#</a> イテレーターの比較</h2> <p>イテレーターは比較できる。同じ順番の要素を指すイテレーターは等しく、そうではないイテレーターは等しくない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> x <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> y <span class="token operator">=</span> x <span class="token punctuation">;</span>

    <span class="token comment">// x, yは0番目の要素を指す</span>

    <span class="token keyword">bool</span> b1 <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token keyword">bool</span> b2 <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> y<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// false</span>

    <span class="token operator">++</span>x <span class="token punctuation">;</span> <span class="token comment">// xは1番目の要素を指す。</span>

    <span class="token keyword">bool</span> b3 <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token keyword">bool</span> b4 <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> y<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="最後の次の要素へのイテレーター"><a href="014-iterator.html#最後の次の要素へのイテレーター" class="header-anchor">#</a> 最後の次の要素へのイテレーター</h2> <p><code>std::begin(v)</code>は<code>vector</code>の変数<code>v</code>の最初の要素を指し示すイテレーターを取得する。</p> <p><code>std::end(v)</code>は<code>vector</code>の変数<code>v</code>の最後の次の要素を指し示すイテレーターを取得する。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 最後の次の要素を指し示すイテレーター</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最後の次の要素とは何か。ある<code>vector&lt;int&gt;</code>の変数の中身が<code>{1,2,3,4,5}</code>のとき、最初の0番目の要素の値は<code>1</code>だ。最後の4番目の要素の値は<code>5</code>だ。最後の次の要素とは、値が<code>5</code>の最後の要素の次の要素だ。そのような要素は実際には存在しないが、<code>std::end</code>は概念として最後の次の要素を返す。</p> <p>最後の次の要素を指し示すイテレーターに対して、<code>*</code>で要素にアクセスを試みるとエラーになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token operator">*</span>i <span class="token punctuation">;</span> <span class="token comment">// エラー</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最後の次の要素を<code>++</code>しようとするとエラーになる。<code>--</code>することはできる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token operator">--</span>i <span class="token punctuation">;</span>   <span class="token comment">// 最後の要素を指す</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span>    <span class="token comment">// 5</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>   <span class="token comment">// 最後の次の要素を指す</span>
    <span class="token operator">*</span>i <span class="token punctuation">;</span>    <span class="token comment">// エラー</span>
<span class="token punctuation">}</span>
</code></pre></div><p>実際には存在しない最後の次の要素を指し示すイテレーターは何の役に立つのか。答えはイテレーターの比較だ。</p> <p>実際には存在しない最後の次の要素を指すイテレーターに<code>'*'</code>を使って要素にアクセスするのはエラーだが、イテレーター同士の比較はできる。すでに説明したように、イテレーターの比較は同じ要素を指す場合は<code>true</code>、違う要素を指す場合は<code>false</code>になる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token comment">// xは最初の要素を指す</span>
    <span class="token keyword">auto</span> x <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// yは最後の次の要素を指す</span>
    <span class="token keyword">auto</span> y <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>


    x <span class="token operator">==</span> y <span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token operator">++</span>x <span class="token punctuation">;</span> <span class="token comment">// xは最初の次の要素を指す</span>
    x <span class="token operator">==</span> y <span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token operator">++</span>x <span class="token punctuation">;</span> <span class="token comment">// xは最後の要素を指す</span>
    x <span class="token operator">==</span> y <span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token operator">++</span>x <span class="token punctuation">;</span> <span class="token comment">// xは最後の次の要素を指す</span>
    x <span class="token operator">==</span> y <span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>std::end</code>で取得する最後の次の要素を指すイテレーターと比較することで、イテレーターが最後の次の要素を指し示す状態に到達したことを判定できる。</p> <p>ということは、<code>vector</code>の要素を先頭から最後まで順番に出力するプログラムは、以下のように書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">auto</span> iter <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> last <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
          iter <span class="token operator">!=</span> last <span class="token punctuation">;</span> <span class="token operator">++</span>iter <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>iter <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="なんでもイテレーター"><a href="014-iterator.html#なんでもイテレーター" class="header-anchor">#</a> なんでもイテレーター</h2> <p>イテレーターというのは要素にアクセスする回りくどくて面倒な方法に見える。イテレーターという面倒なものを使わずに、<code>vector::at(i)</code>で<code>i</code>番目の要素にアクセスする方が楽ではないか。そう考える読者もいるだろう。イテレーターの利点はその汎用性にある。イテレーターの作法に従うことで、さまざまな処理が同じコードで書けるようになるのだ。</p> <p>たとえば、<code>vector</code>の要素を先頭から順番に出力する処理を振り返ってみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span> std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">!=</span> std<span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードは<code>vector</code>にしか使えないコードだ。イテレーターで書き直してみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">auto</span> iter <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> last <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
          iter <span class="token operator">!=</span> last <span class="token punctuation">;</span> <span class="token operator">++</span>iter <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>iter <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>そして、この要素を先頭から出力する処理を関数にしてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> output_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">auto</span> first<span class="token punctuation">,</span> <span class="token keyword">auto</span> last <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">auto</span> iter <span class="token operator">=</span> first <span class="token punctuation">;</span> iter <span class="token operator">!=</span> last <span class="token punctuation">;</span> <span class="token operator">++</span>iter <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>iter <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token function">output_all</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>この<code>関数output_all</code>は<code>vector</code>以外のイテレーターにも対応している。C++にはさまざまなイテレーターがある。例えば標準入力から値を受け取るイテレーターがある。さっそく使ってみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">first</span><span class="token punctuation">(</span> std<span class="token operator">::</span>cin <span class="token punctuation">)</span><span class="token punctuation">,</span> last <span class="token punctuation">;</span>

    <span class="token function">output_all</span><span class="token punctuation">(</span> first<span class="token punctuation">,</span> last <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このプログラムは標準入力から<code>int</code>型の値を受け取り、それをそのまま標準出力する。</p> <p>C++にはほかにも、カレントディレクトリーにあるファイルの一覧を取得するイテレーターがある。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>filesystem<span class="token operator">::</span>directory_iterator <span class="token function">first</span><span class="token punctuation">(</span><span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> last <span class="token punctuation">;</span>

    <span class="token function">output_all</span><span class="token punctuation">(</span> first<span class="token punctuation">,</span> last <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>関数output_all</code>のコードは何も変えていないのに、さまざまなイテレーターに対応できる。イテレーターというお作法にのっとることで、さまざまな処理が可能になるのだ。</p> <p>これは出力にも言えることだ。<code>関数output_all</code>は<code>std::cout</code>に出力していた。これをイテレーターに対する書き込みに変えてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> output_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">auto</span> first<span class="token punctuation">,</span> <span class="token keyword">auto</span> last<span class="token punctuation">,</span> <span class="token keyword">auto</span> output_iter <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">auto</span> iter <span class="token operator">=</span> first <span class="token punctuation">;</span> iter <span class="token operator">!=</span> last <span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">,</span> <span class="token operator">++</span>output_iter <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token operator">*</span>output_iter <span class="token operator">=</span> <span class="token operator">*</span>iter <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span>
</code></pre></div><p>書き換えた<code>関数output_all</code>は新しく<code>output_iter</code>という引数を取る。これはイテレーターだ。<code>std::cout</code>に出力する代わりに、このイテレーターに書き込むように変更している。</p> <p>こうすることによって、出力にもさまざまなイテレーターが使える。</p> <p>標準出力に出力するイテレーターがある。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    
    <span class="token function">output_all</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span>
                std<span class="token operator">::</span>ostream_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>std<span class="token operator">::</span>cout<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>vector</code>も出力先にできる。つまり<code>vector</code>のコピーだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> source <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">destination</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token function">output_all</span><span class="token punctuation">(</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span> destination <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>destination(5)</code>というのは、<code>vector</code>にあらかじめ5個の要素を入れておくという意味だ。あらかじめ入っている要素の値は<code>int</code>の場合ゼロになる。</p> <p>このほかにもイテレーターはさまざまある。自分でイテレーターを作ることもできる。そして、<code>関数output_all</code>はイテレーターにさえ対応していればさまざまな処理にコードを1行たりとも変えずに使えるのだ。</p> <h2 id="イテレーターと添字の範囲"><a href="014-iterator.html#イテレーターと添字の範囲" class="header-anchor">#</a> イテレーターと添字の範囲</h2> <p>イテレーターは順序のある値の集合を表現するために、最初の要素への参照と、最後の次の要素への参照のペアを用いる。</p> <p>たとえば、<code>{1,2,3,4,5}</code>という順序の値の集合があった場合、イテレーターは最初の要素である<code>1</code>と最後の1つ次の要素である5の次の架空の要素を指し示す。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> j <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このようにして範囲を表現することを、<code>半閉鎖(half-closed)</code>とか、<code>[i,j)</code>などと表現する。</p> <p>この状態から<code>{2,3,4,5}</code>のような値の集合を表現したい場合、イテレーター<code>i</code>をインクリメントすればよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token operator">++</span>i <span class="token punctuation">;</span>
</code></pre></div><p>これで<code>[i,j)</code>は<code>{2,3,4,5}</code>になった。</p> <p>このような範囲の表現方法に疑問を感じる読者もいるだろう。なぜ最後の次の要素という本来存在しない架空の要素をあたかも参照しているかのようなイテレーターが必要なのか。最後の要素を参照するのではだめなのか。</p> <p>そのような範囲の表現方法は、<code>閉鎖(closed)</code>とか<code>[i,j]</code>などと表現する。</p> <p>実はこの方法は<code>vector</code>の要素の順番を指定する方法と同じなのだ。</p> <p><code>{1,2,3,4,5}</code>と5個の順序ある要素からなる<code>vector</code>では、最初の要素は0番目で、最後の要素は4番目だ。1番目から5番目ではない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 最初の要素: 1</span>
    v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 最後の要素: 5</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ではなぜなのか。なぜ<code>vector</code>では$n$個の要素の順番を0番目から$n-1$番目として表現するのか。</p> <p>実はC++に限らず、現在使われているすべてのプログラミングはインデックスを<code>0</code>から始めている。かつてはインデックスを<code>1</code>から始める言語も存在したが、そのような言語はいまは使われていない。</p> <p>この疑問はエドガー・ダイクストラ(Edsger Wybe Dijkstra)が&quot;Why numbering should start at zero&quot;(EWD831)で解説している。</p> <p>2, 3, ..., 12の範囲の自然数を表現するのに、慣習的に以下の4つの表記がある。</p> <p>$$
a) 2 \le i \lt 13
$$</p> <p>$$
b) 1 \lt i \le 12
$$</p> <p>$$
c) 2 \le i \le 12
$$</p> <p>$$
d) 1 \lt i \lt 13
$$</p> <p>C++のイテレーターはa)を元にしている。</p> <p>この4つのうち、a)とb)は上限から下限を引くと、範囲にある自然数の個数である11になる。</p> <p>この性質はとても便利なのでC++でも、イテレーター同士の引き算ができるようになっている。イテレーター<code>i</code>, <code>j</code>($i \le j$)で<code>j - i</code>をした結果はイテレーターの範囲の要素の個数だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">auto</span> j <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token comment">// 11</span>
    <span class="token comment">// イテレーターの範囲の要素の個数</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> j <span class="token operator">-</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>

    <span class="token operator">++</span>i <span class="token punctuation">;</span> <span class="token comment">// 先頭の次の要素を指す</span>
    <span class="token comment">// 10</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> j <span class="token operator">-</span> i <span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>a)とb)はどちらがいいのだろうか。b)を元にイテレーターを設計すると以下のようになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// b)案を採用する場合</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token comment">// 最初の1つ前の架空の要素を指す</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 最後の要素を指す</span>
    <span class="token keyword">auto</span> j <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token comment">// 最初の要素を指すようにする。</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>

    <span class="token comment">// iが最後の要素を指すとループを抜ける</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token punctuation">;</span> i <span class="token operator">!=</span> j <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最後の要素を処理する</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>i <span class="token punctuation">;</span>
    

<span class="token punctuation">}</span>
</code></pre></div><p>a)の方がよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// a)案を採用する場合</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token comment">// 最初の要素を指す</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 最後の次の要素を指す</span>
    <span class="token keyword">auto</span> j <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token comment">// iが最後の次の要素を指すとループを抜ける</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token punctuation">;</span> i <span class="token operator">!=</span> j <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// すべての要素について処理を終えている</span>
<span class="token punctuation">}</span>
</code></pre></div><p>b)案では末尾から先頭まで後ろ向きに要素を一巡する操作はやりやすいが、実際には先頭から末尾まで一巡する操作の方が多い。</p> <p>C++では要素の順番を数値で指し示すとき、最初の要素は0番目であり、次の要素は1番目であり、$N$個目の要素は$N-1$番目になっている。この数値で指し示すことを<code>添字</code>とか<code>インデックス</code>というがなぜ最初の要素を1番目にしないのか。</p> <p>C++ではさまざまなところでa)を採用している。これを添字に適用すると、最初の要素が1番目から始まる場合、$N$個の要素を参照する添字の範囲は$1 \le i \lt N+1$になる。そのような場合、以下のようなコードになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 最初の要素が1番目の場合</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 5個の要素を持つvector</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token comment">// iの値の範囲は1から5まで</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre></div><p>要素数は5個なのに<code>6</code>が出てくる。最初の要素が0番目の場合、$N$個の要素を参照する添字の範囲は$0 \le i \lt N$になる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 最初の要素が0番目の場合</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 5個の要素を持つvector</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token comment">// iの値の範囲は0から5まで</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre></div><p>一貫性のために最初の要素は0番目となっている。</p> <p>また、空の集合にも対応できる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 空</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token punctuation">;</span>

    <span class="token comment">// 空なので何も出力されない</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>   <span class="token keyword">auto</span> i <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> j <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            i <span class="token operator">!=</span> j <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>変数<code>v</code>は空なので<code>i != j</code>は<code>false</code>となり、<code>for</code>文の中の文は一度も実行されない。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="013-names.html" class="prev">名前</a></span> <span class="next"><a href="015-reference.html">lvalueリファレンスとconst</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="assets/js/app.8620998f.js" defer></script><script src="assets/js/2.7009e9ba.js" defer></script><script src="assets/js/19.966431ea.js" defer></script>
  </body>
</html>
