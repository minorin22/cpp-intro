<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ループ | 江添亮のC++入門</title>
    <meta name="description" content="">
    <link rel="icon" href="64.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="152.png">
  <meta name="msapplication-TileImage" content="/144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="assets/css/0.styles.17f32d1e.css" as="style"><link rel="preload" href="assets/js/app.8620998f.js" as="script"><link rel="preload" href="assets/js/2.7009e9ba.js" as="script"><link rel="preload" href="assets/js/13.85764695.js" as="script"><link rel="prefetch" href="assets/js/10.0bc4fb9f.js"><link rel="prefetch" href="assets/js/11.c5d46ffe.js"><link rel="prefetch" href="assets/js/12.cec763ba.js"><link rel="prefetch" href="assets/js/14.56c0c5a1.js"><link rel="prefetch" href="assets/js/15.ba58285d.js"><link rel="prefetch" href="assets/js/16.663fe3ce.js"><link rel="prefetch" href="assets/js/17.b9e53cc4.js"><link rel="prefetch" href="assets/js/18.468131c1.js"><link rel="prefetch" href="assets/js/19.966431ea.js"><link rel="prefetch" href="assets/js/20.39088cad.js"><link rel="prefetch" href="assets/js/21.f1d2fbe4.js"><link rel="prefetch" href="assets/js/22.53af9436.js"><link rel="prefetch" href="assets/js/23.45c08f75.js"><link rel="prefetch" href="assets/js/24.fec53f63.js"><link rel="prefetch" href="assets/js/25.1c55ab94.js"><link rel="prefetch" href="assets/js/26.97221aa1.js"><link rel="prefetch" href="assets/js/27.ad617385.js"><link rel="prefetch" href="assets/js/28.1d1956f2.js"><link rel="prefetch" href="assets/js/29.bb17ac3f.js"><link rel="prefetch" href="assets/js/3.a3b2b660.js"><link rel="prefetch" href="assets/js/30.3861fe0d.js"><link rel="prefetch" href="assets/js/31.93e5e7a5.js"><link rel="prefetch" href="assets/js/32.7f1f5a03.js"><link rel="prefetch" href="assets/js/33.ba1ef509.js"><link rel="prefetch" href="assets/js/34.63b70d43.js"><link rel="prefetch" href="assets/js/35.2cf21250.js"><link rel="prefetch" href="assets/js/36.93604af5.js"><link rel="prefetch" href="assets/js/37.132be8e6.js"><link rel="prefetch" href="assets/js/38.32a3f051.js"><link rel="prefetch" href="assets/js/39.bab7cf23.js"><link rel="prefetch" href="assets/js/4.3ff2fe10.js"><link rel="prefetch" href="assets/js/40.2cd9628c.js"><link rel="prefetch" href="assets/js/41.24bfe547.js"><link rel="prefetch" href="assets/js/42.39ebe085.js"><link rel="prefetch" href="assets/js/43.4ff95f43.js"><link rel="prefetch" href="assets/js/44.f1a016d7.js"><link rel="prefetch" href="assets/js/45.590d3d64.js"><link rel="prefetch" href="assets/js/46.46b99b9b.js"><link rel="prefetch" href="assets/js/47.483b5213.js"><link rel="prefetch" href="assets/js/48.65facf6a.js"><link rel="prefetch" href="assets/js/49.2bda166c.js"><link rel="prefetch" href="assets/js/5.7f8f4812.js"><link rel="prefetch" href="assets/js/50.858dc861.js"><link rel="prefetch" href="assets/js/51.a40bec0a.js"><link rel="prefetch" href="assets/js/52.f5dc4f7e.js"><link rel="prefetch" href="assets/js/53.4cfac598.js"><link rel="prefetch" href="assets/js/54.9b6224cf.js"><link rel="prefetch" href="assets/js/55.4fb7a3ba.js"><link rel="prefetch" href="assets/js/56.8a7823a6.js"><link rel="prefetch" href="assets/js/6.af1283dd.js"><link rel="prefetch" href="assets/js/7.401cafeb.js"><link rel="prefetch" href="assets/js/8.44430c93.js"><link rel="prefetch" href="assets/js/9.39e986e2.js">
    <link rel="stylesheet" href="assets/css/0.styles.17f32d1e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="index.html" class="home-link router-link-active"><!----> <span class="site-name">江添亮のC++入門</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="000-preface.html" class="sidebar-link">序</a></li><li><a href="001-intro.html" class="sidebar-link">C++の概要</a></li><li><a href="002-build.html" class="sidebar-link">C++の実行</a></li><li><a href="003-guide-to-c++.html" class="sidebar-link">C++ヒッチハイクガイド</a></li><li><a href="004-debug-compile-error.html" class="sidebar-link">デバッグ：コンパイルエラーメッセージの読み方</a></li><li><a href="005-the-restaurant-at-the-end-of-the-branch.html" class="sidebar-link">条件分岐の果てのレストラン</a></li><li><a href="006-debug-compile-warning.html" class="sidebar-link">デバッグ: コンパイル警告メッセージ</a></li><li><a href="007-standard-input.html" class="sidebar-link">最近体重が気になるあなたのための標準入力</a></li><li><a href="008-loop.html" class="active sidebar-link">ループ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="008-loop.html#これまでのおさらい" class="sidebar-link">これまでのおさらい</a></li><li class="sidebar-sub-header"><a href="008-loop.html#goto文" class="sidebar-link">goto文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#while文" class="sidebar-link">while文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#for文" class="sidebar-link">for文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#do文" class="sidebar-link">do文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#break文" class="sidebar-link">break文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#continue文" class="sidebar-link">continue文</a></li><li class="sidebar-sub-header"><a href="008-loop.html#再帰関数" class="sidebar-link">再帰関数</a></li></ul></li><li><a href="009-vector.html" class="sidebar-link">メモリーを無限に確保する</a></li><li><a href="010-debug-printf.html" class="sidebar-link">デバッグ：printfデバッグ</a></li><li><a href="011-integer.html" class="sidebar-link">整数</a></li><li><a href="012-floating-point.html" class="sidebar-link">浮動小数点数</a></li><li><a href="013-names.html" class="sidebar-link">名前</a></li><li><a href="014-iterator.html" class="sidebar-link">イテレーターの基礎</a></li><li><a href="015-reference.html" class="sidebar-link">lvalueリファレンスとconst</a></li><li><a href="016-algorithm.html" class="sidebar-link">アルゴリズム</a></li><li><a href="017-lambda.html" class="sidebar-link">ラムダ式</a></li><li><a href="018-class.html" class="sidebar-link">クラスの基本</a></li><li><a href="019-operator-overloading.html" class="sidebar-link">より自然に振る舞うクラス</a></li><li><a href="020-array.html" class="sidebar-link">std::array</a></li><li><a href="021-three-virtues-of-a-programmer.html" class="sidebar-link">プログラマーの三大美徳</a></li><li><a href="022-implement-array.html" class="sidebar-link">配列</a></li><li><a href="023-template.html" class="sidebar-link">テンプレート</a></li><li><a href="024-more-array.html" class="sidebar-link">arrayをさらに実装</a></li><li><a href="025-array-iterator.html" class="sidebar-link">arrayのイテレーター</a></li><li><a href="026-exception.html" class="sidebar-link">傲慢なエラー処理: 例外</a></li><li><a href="027-pointer.html" class="sidebar-link">ポインター</a></li><li><a href="028-pointer-semantics.html" class="sidebar-link">意味上のポインター</a></li><li><a href="029-pointer-syntax.html" class="sidebar-link">文法上のポインター</a></li><li><a href="030-pointer-details.html" class="sidebar-link">ポインターの内部実装</a></li><li><a href="031-iterator-operations.html" class="sidebar-link">イテレーター詳細</a></li><li><a href="032-memory-allocation.html" class="sidebar-link">動的メモリー確保</a></li><li><a href="033-vector-implementation.html" class="sidebar-link">vectorの実装 : 基礎</a></li><li><a href="034-vector-memory-allocation.html" class="sidebar-link">vectorの実装 : メモリー確保</a></li><li><a href="035-copy.html" class="sidebar-link">コピー</a></li><li><a href="036-move.html" class="sidebar-link">ムーブ</a></li><li><a href="037-rvalue-reference.html" class="sidebar-link">rvalueリファレンス</a></li><li><a href="038-move-semantics.html" class="sidebar-link">ムーブの実装</a></li><li><a href="039-disable-copy.html" class="sidebar-link">コピーの禁止</a></li><li><a href="040-smart-pointer.html" class="sidebar-link">スマートポインター</a></li><li><a href="041-move-support.html" class="sidebar-link">自作の数値クラスで演算をムーブに対応する方法</a></li><li><a href="042-string-intro.html" class="sidebar-link">文字列</a></li><li><a href="043-random.html" class="sidebar-link">乱数</a></li><li><a href="044-random-part2.html" class="sidebar-link">ポアソン分布</a></li><li><a href="045-random-part3.html" class="sidebar-link">正規分布</a></li><li><a href="046-random-part4.html" class="sidebar-link">サンプリング分布(sampling distributions)</a></li><li><a href="200-cpp.html" class="sidebar-link">Cプリプロセッサー</a></li><li><a href="300-multiple-source-files.html" class="sidebar-link">分割コンパイル</a></li><li><a href="400-gdb.html" class="sidebar-link">デバッガー</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ループ"><a href="008-loop.html#ループ" class="header-anchor">#</a> ループ</h1> <p>さて、ここまでで変数や関数、標準入出力といったプログラミングの基礎的な概念を教えてきた。あと1つでプログラミングに必要な基礎的な概念はすべて説明し終わる。ループだ。</p> <h2 id="これまでのおさらい"><a href="008-loop.html#これまでのおさらい" class="header-anchor">#</a> これまでのおさらい</h2> <p>C++では、プログラムは書いた順番に実行される。これを<code>逐次実行</code>という。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">3</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>実行結果、</p> <div class="language- extra-class"><pre class="language-text"><code>123
</code></pre></div><p>この実行結果が<code>&quot;123&quot;</code>以外の結果になることはない。C++ではプログラムは書かれた順番に実行されるからだ。</p> <p>条件分岐は、プログラムの実行を条件付きで行うことができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token punctuation">;</span>

    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">3</span> <span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">5</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>実行結果、</p> <div class="language- extra-class"><pre class="language-text"><code>134
</code></pre></div><p>条件分岐によって、プログラムの一部を実行しないということが可能になる。</p> <h2 id="goto文"><a href="008-loop.html#goto文" class="header-anchor">#</a> goto文</h2> <p>ここでは繰り返し(ループ)の基礎的な仕組みを理解するために、最も原始的で最も使いづらい繰り返しの機能である<code>goto文</code>を学ぶ。<code>goto文</code>で実用的な繰り返し処理をするのは面倒だが、恐れることはない。より簡単な方法もすぐに説明するからだ。なぜ本書で<code>goto文</code>を先に教えるかというと、あらゆる繰り返しは、けっきょくのところ<code>if文</code>と<code>goto文</code>へのシンタックスシュガーにすぎないからだ。<code>goto文</code>を学ぶことにより、繰り返しを恐れることなく使う本物のプログラマーになれる。</p> <h3 id="無限ループ"><a href="008-loop.html#無限ループ" class="header-anchor">#</a> 無限ループ</h3> <p><code>&quot;hello\n&quot;</code>と3回出力するプログラムはどうやって書くのだろうか。<code>&quot;hello\n&quot;</code>を1回出力するプログラムの書き方はすでにわかっているので、同じ文を3回書けばよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 1回&quot;hello\n&quot;を出力する関数</span>
<span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>10回出力する場合はどうするのだろう。10回書けばよい。コードは省略する。</p> <p>では100回出力する場合はどうするのだろう。100回書くのだろうか。100回も同じコードを書くのはとても面倒だ。読者がVimのような優秀なテキストエディターを使っていない限り100回も同じコードを間違えずに書くことは不可能だろう。Vimならば1回書いたあとにノーマルモードで<code>&quot;100.&quot;</code>するだけで100回書ける。</p> <p>実際のところ、100回だろうが、1000回だろうが、あらかじめ回数がコンパイル時に決まっているのであれば、その回数だけ同じ処理を書くことで実現可能だ。</p> <p>しかし、プログラムを外部から強制的に停止させるまで、無限に出力し続けるプログラムはどう書けばいいのだろうか。そういった停止しないプログラムを外部から強制的に停止させるには<code>Ctrl-C</code>を使う。</p> <p>以下はそのようなプログラムの実行例だ。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
hello
hello
hello
hello
...
[Ctrl-Cを押す]
</code></pre></div><p><code>goto文</code>は指定したラベルに実行を移す機能だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>ラベル名 <span class="token operator">:</span> 文

<span class="token keyword">goto</span> ラベル名 <span class="token punctuation">;</span>
</code></pre></div><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token punctuation">;</span>

    <span class="token comment">// ラベルskipまで飛ぶ</span>
    <span class="token keyword">goto</span> skip <span class="token punctuation">;</span>

    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token punctuation">;</span>

<span class="token comment">// ラベルskip</span>
skip <span class="token operator">:</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token number">3</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これを実行すると以下のようになる。</p> <div class="language- extra-class"><pre class="language-text"><code>13
</code></pre></div><p><code>2</code>を出力すべき文の実行が飛ばされていることがわかる。</p> <p>これだけだと<code>&quot;if (false)&quot;</code>と同じように見えるが、<code>goto文</code>はソースコードの上に飛ぶこともできるのだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
loop <span class="token operator">:</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>これは<code>&quot;hello\n&quot;</code>を無限に出力するプログラムだ。</p> <p>このプログラムを実行すると、</p> <ol><li>関数<code>hello</code>が呼ばれる</li> <li><code>goto</code>文でラベル<code>loop</code>まで飛ぶ</li> <li>1.に戻る</li></ol> <p>という処理を行う。</p> <h3 id="終了条件付きループ"><a href="008-loop.html#終了条件付きループ" class="header-anchor">#</a> 終了条件付きループ</h3> <p>ひたすら同じ文字列を出力し続けるだけのプログラムというのも味気ない。もっと面白くてためになるプログラムを作ろう。例えば、ユーザーから入力された数値を合計し続けるプログラムはどうだろう。</p> <p>いまから作るプログラムを実行すると以下のようになる。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
&gt; 10
10
&gt; 5
15
&gt; 999
1014
&gt; -234
780
</code></pre></div><p>このプログラムは、</p> <ol><li><code>&quot;\&gt;&quot;</code>と表示してユーザーから整数値を入力</li> <li>これまでの入力との合計値を出力</li> <li>1.に戻る</li></ol> <p>という動作を繰り返す。先ほど学んだ無限ループと同じだ。</p> <p>さっそく作っていこう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;&gt;&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    sum <span class="token operator">=</span> sum <span class="token operator">+</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>関数<code>input</code>は<code>&quot;\&gt;&quot;</code>を表示してユーザーからの入力を得て戻り値として返すだけの関数だ。</p> <p><code>&quot;sum = sum + input()&quot;</code>は、変数<code>sum</code>に新しい値を代入するもので、その代入する値というのは、代入する前の変数<code>sum</code>の値と関数<code>input</code>の戻り値を足した値だ。</p> <p>このような変数<code>x</code>に何らかの値<code>n</code>を足した結果を元の変数<code>x</code>に代入するという処理はとても多く使われるので、C++では<code>&quot;x = x + n&quot;</code>を意味する省略記法<code>&quot;x += n&quot;</code>がある。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">;</span>

    x <span class="token operator">=</span> x <span class="token operator">+</span> n <span class="token punctuation">;</span> <span class="token comment">// 6</span>
    x <span class="token operator">+=</span> n <span class="token punctuation">;</span> <span class="token comment">// 11</span>
<span class="token punctuation">}</span>
</code></pre></div><p>さて、本題に戻ろう。上のプログラムは動く。しかし、プログラムを停止するには<code>Ctrl-C</code>を押すしかない。できればプログラム自ら終了してもらいたいものだ。</p> <p>そこで、ユーザーが<code>0</code>を入力したときはプログラムを終了するようにしよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;&gt;&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    <span class="token comment">// 一度入力を変数に代入</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 変数xが0でない場合</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token comment">// 実行</span>
        sum <span class="token operator">=</span> sum <span class="token operator">+</span> x <span class="token punctuation">;</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// x == 0の場合、ここに実行が移る</span>
    <span class="token comment">// main関数の最後なのでプログラムが終了</span>
<span class="token punctuation">}</span>
</code></pre></div><p>うまくいった。このループは、ユーザーが<code>0</code>を入力した場合に繰り返しを終了する、条件付きのループだ。</p> <h3 id="インデックスループ"><a href="008-loop.html#インデックスループ" class="header-anchor">#</a> インデックスループ</h3> <p>最後に紹介するループは、インデックスループだ。$n$回<code>&quot;hello\n&quot;s</code>を出力するプログラムを書こう。問題は、この$n$はコンパイル時には与えられず、実行時にユーザーからの入力で与えられる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// n回出力する関数の宣言</span>
<span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ユーザーからの入力</span>
    <span class="token keyword">int</span> n <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> n <span class="token punctuation">;</span>
    <span class="token comment">// n回出力</span>
    <span class="token function">hello_n</span><span class="token punctuation">(</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードをコンパイルしようとするとエラーになる。これは実はコンパイルエラーではなくてリンクエラーという種類のエラーだ。その理由は、関数<code>hello_n</code>に対する関数の定義が存在しないからだ。</p> <p>関数というのは宣言と定義に分かれている。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 関数の宣言</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 宣言</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token punctuation">)</span>
<span class="token comment">// 定義</span>
<span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>関数の宣言というのは何度書いても大丈夫だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 宣言</span>
<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 再宣言</span>
<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 再宣言</span>
<span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>関数の宣言というのは戻り値の型や関数名や引数リストだけで、<code>&quot;;&quot;</code>で終わる。</p> <p>関数の定義とは、関数の宣言のあとの<code>&quot;{}&quot;</code>だ。この場合、宣言のあとに<code>&quot;;&quot;</code>は書かない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>関数の定義は一度しか書けない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 定義</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// エラー、再定義</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>なぜ関数は宣言と定義とに分かれているかというと、C++では名前は宣言しないと使えないためだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// エラー</span>
    <span class="token comment">// 名前fは宣言されていない</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定義</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>なので、必ず名前は使う前に宣言しなければならない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 名前fの宣言</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// OK、名前fは関数</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 名前fの定義</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>さて、話を元に戻そう。これから学ぶのは$n$回<code>&quot;hello\n&quot;s</code>と出力するプログラムの書き方だ。ただし$n$はユーザーが入力するので実行時にしかわからない。すでに我々はユーザーから$n$の入力を受け取る部分のプログラムは書いた。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// n回出力する関数の宣言</span>
<span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ユーザーからの入力</span>
    <span class="token keyword">int</span> n <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> n <span class="token punctuation">;</span>
    <span class="token comment">// n回出力</span>
    <span class="token function">hello_n</span><span class="token punctuation">(</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>あとは関数<code>hello_n(n)</code>が$n$回<code>&quot;hello\n&quot;s</code>と出力するようなループを実行すればいいのだ。</p> <p>すでに我々は無限回<code>&quot;hello\n&quot;s</code>と出力する方法を知っている。まずは無限回ループを書こう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
loop <span class="token operator">:</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>終了条件付きループで学んだように、このループを$n$回繰り返した場合に終了させるには、<code>if文</code>を使って、終了条件に達したかどうかで実行を分岐させればよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
loop <span class="token operator">:</span>
    <span class="token comment">// まだn回繰り返していない場合</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">// 以下を実行</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードを完成させるにはどうすればいいのか。まず、現在何回繰り返しを行ったのか記録する必要がある。このために変数を作る。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
</code></pre></div><p>変数<code>i</code>の初期値は0だ。まだ繰り返し実行を1回も行っていないということは、つまり0回繰り返し実行をしたということだ。</p> <p>1回繰り返し実行をするたびに、変数<code>i</code>の値を1増やす。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">;</span>
</code></pre></div><p>これはすでに学んだように、もっと簡単に書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>i <span class="token operator">+=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
</code></pre></div><p>実は、さらに簡単に書くこともできる。変数の代入前の値に1を足した値を代入する、つまり変数の値を1増やすというのはとてもよく書くコードなので、とても簡単な演算子が用意されている。<code>operator ++</code>だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span> <span class="token comment">// 2</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これで変数<code>i</code>の値は1増える。これをインクリメント(increment)という。</p> <p>インクリメントと対になるのがデクリメント(decrement)だ。これは変数の値を1減らす。演算子は<code>operator --</code>だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token operator">--</span>i <span class="token punctuation">;</span> <span class="token comment">// -1</span>
    <span class="token operator">--</span>i <span class="token punctuation">;</span> <span class="token comment">// -2</span>
    <span class="token operator">--</span>i <span class="token punctuation">;</span> <span class="token comment">// -3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>さて、必要な知識は学び終えたので本題に戻ろう。$n$回の繰り返しをしたあとにループを終了するには、まずいま何回繰り返し実行しているのかを記録する必要がある。その方法を学ぶために、0, 1, 2, 3, 4...と無限に出力されるプログラムを書いてみよう。</p> <p>このプログラムを実行すると以下のように表示される。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
1, 2, 3, 4, 5, 6, [Ctrl-C]
</code></pre></div><p><code>Ctrl-C</code>を押すまでプログラムは無限に実行される。</p> <p>ではどうやって書くのか。以下のようにする。</p> <ol><li>変数<code>i</code>を作り、値を<code>0</code>にする</li> <li>変数<code>i</code>と<code>&quot;, &quot;s</code>を出力する</li> <li>変数<code>i</code>をインクリメントする</li> <li><code>goto</code> 2.</li></ol> <p>この処理を素直に書くと以下のコードになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1. 変数iを作り、値を0にする</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    <span class="token comment">// 2. 変数iと&quot;, &quot;sを出力する</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span>s <span class="token punctuation">;</span>
    <span class="token comment">// 3. 変数iをインクリメントする</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token comment">// 4. goto 2</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>どうやら、いま何回繰り返し実行しているか記録することはできるようになったようだ。</p> <p>ここまでくればしめたもの。あとは<code>goto文</code>を実行するかどうかを<code>if文</code>で条件分岐すればよい。しかし、<code>if文</code>の中にどんな条件を書けばいいのだろうか。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    <span class="token comment">// まだn回繰り返し実行をしていなければ実行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>具体的に考えてみよう。<code>n == 3</code>のとき、つまり3回繰り返すときを考えよう。</p> <ol><li>1回目の<code>if</code>文実行のとき、<code>i == 0</code></li> <li>2回目の<code>if</code>文実行のとき、<code>i == 1</code></li> <li>3回目の<code>if</code>文実行のとき、<code>i == 2</code></li> <li>4回目の<code>if</code>文実行のとき、<code>i == 3</code></li></ol> <p>ここでは<code>n == 3</code>なので、3回まで実行してほしい。つまり3回目までは<code>true</code>になり、4回目の<code>if</code>文実行のときには<code>false</code>になるような式を書く。そのような式とは、ズバリ<code>&quot;i != n&quot;</code>だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">!=</span> n <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>さっそく実行してみよう。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
3
hello
hello
hello
$ make run
2
hello
hello
</code></pre></div><p>なるほど、動くようだ。しかしこのプログラムにはバグがある。<code>-1</code>を入力すると、なぜか大量の<code>hello</code>が出力されてしまうのだ。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
-1
hello
hello
hello
hello
[Ctrl-C]
</code></pre></div><p>この原因はまだ現時点の読者には難しい。この謎はいずれ明らかにするとして、いまは<code>n</code>が負数の場合にプログラムを0回の繰り返し分の実行で終了するように書き換えよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// nが負数ならば</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token comment">// 関数の実行を終了</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
loop <span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">!=</span> n <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="while文"><a href="008-loop.html#while文" class="header-anchor">#</a> while文</h2> <p><code>goto文</code>は極めて原始的で使いづらい機能だ。現実のC++プログラムでは<code>goto文</code>はめったに使われない。もっと簡単な機能を使う。ではなぜ<code>goto文</code>が存在するかというと、<code>goto文</code>は最も原始的で基礎的で、ほかの繰り返し機能は<code>if文</code>と<code>goto文</code>に変換することで実現できるからだ。</p> <p><code>goto文</code>より簡単な繰り返し文に、<code>while文</code>がある。ここでは<code>goto文</code>と<code>while文</code>を比較することで、<code>while文</code>を学んでいこう。</p> <h3 id="無限ループ-2"><a href="008-loop.html#無限ループ-2" class="header-anchor">#</a> 無限ループ</h3> <p>無限ループを<code>goto文</code>で書く方法を思い出してみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> hello <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>

loop <span class="token operator">:</span>
    <span class="token comment">// 繰り返し実行される文</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードで本当に重要なのは関数<code>hello</code>を呼び出している部分だ。ここが繰り返し実行される文で、<code>ラベル文</code>と<code>goto文</code>は、繰り返し実行を実現するために必要な記述でしかない。</p> <p>そこで<code>while(true)</code>だ。<code>while(true)</code>は<code>goto文</code>と<code>ラベル文</code>よりも簡単に無限ループを実現できる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> 文
</code></pre></div><p><code>while文</code>は文を無限に繰り返して実行してくれる。試してみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> hello <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードの重要な部分は以下の2行。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>これを<code>goto文</code>と<code>ラベル文</code>を使った無限ループと比べてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>loop<span class="token operator">:</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
</code></pre></div><p>どちらも同じ意味のコードだが、<code>while文</code>の方が明らかに書きやすくなっているのがわかる。</p> <p><code>goto文</code>で学んだ、ユーザーからの整数値の入力の合計の計算を繰り返すプログラムを<code>while(true)</code>で書いてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;&gt;&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重要なのは以下の5行だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これを<code>goto文</code>で書いた場合と比べてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>loop <span class="token operator">:</span>
    sum <span class="token operator">+=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
</code></pre></div><p>本当に重要で本質的な、繰り返し実行をする部分の2行のコードはまったく変わっていない。それでいて<code>while(true)</code>の方が圧倒的に簡単に書ける。</p> <h3 id="終了条件付きループ-2"><a href="008-loop.html#終了条件付きループ-2" class="header-anchor">#</a> 終了条件付きループ</h3> <p>なるほど、無限ループを書くのに、<code>goto文</code>を使うより<code>while(true)</code>を使った方がいいことがわかった。ではほかのループの場合でも、<code>while文</code>の方が使いやすいだろうか。</p> <p>本書を先頭から読んでいる優秀な読者は<code>while(true)</code>の<code>true</code>は<code>bool</code>型の値であることに気が付いているだろう。実は<code>while(E)</code>の括弧の中<code>E</code>は、<code>if(E)</code>と書くのとまったく同じ<code>条件</code>なのだ。<code>条件</code>が<code>true</code>であれば繰り返し実行される。<code>false</code>なら繰り返し実行されない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> 条件 <span class="token punctuation">)</span> 文
</code></pre></div><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 実行されない</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;No&quot;</span>s <span class="token punctuation">;</span>

    <span class="token comment">// 実行されない</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;No&quot;</span>s <span class="token punctuation">;</span>

    <span class="token comment">// 実行される</span>
    <span class="token comment">// 無限ループ</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Yes&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>while文</code>を使って、<code>0</code>が入力されたら終了する合計値計算プログラムを書いてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;&gt;&quot;</span>s <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> x <span class="token punctuation">;</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重要なのはこの5行。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> x <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> x <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここではちょっと難しいコードが出てくる。<code>while</code>の中の<code>条件</code>が、<code>&quot;( x = input() ) != 0&quot;</code>になっている。これはどういうことか。</p> <p>実は<code>条件</code>は<code>bool型</code>に変換さえできればどんな式でも書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;(x = 1) is 1.\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードでは、&quot;<code>(x=1)</code>&quot;と&quot;<code>1</code>&quot;が等しい&quot;<code>==</code>&quot;かどうかを判断している。&quot;<code>(x=1)</code>&quot;という式は変数<code>x</code>に<code>1</code>を代入する式だ。<code>代入式</code>の値は、代入された変数の値になる。この場合変数<code>x</code>の値だ。変数<code>x</code>には<code>1</code>が代入されているので、その値は1、つまり&quot;<code>(x=1) == 1</code>&quot;は&quot;<code>1 == 1</code>&quot;と書くのと同じ意味になる。この結果は<code>true</code>だ。</p> <p>さて、このことを踏まえて、&quot;<code>( x = input() ) != 0</code>&quot;を考えてみよう。</p> <p>&quot;<code>( x = input() )</code>&quot;は変数<code>x</code>に関数<code>input</code>を呼び出した結果を代入している。関数<code>input</code>はユーザーから入力を得て、その入力をそのまま返す。つまり変数<code>x</code>にはユーザーの入力した値が代入される。その結果が<code>0</code>と等しくない&quot;<code>!=</code>&quot;かどうかを判断している。つまり、ユーザーが<code>0</code>を入力した場合は<code>false</code>、非ゼロを入力した場合は<code>true</code>となる。</p> <p><code>while(条件)</code>は<code>条件</code>が<code>true</code>となる場合に繰り返し実行をする。結果として、ユーザーが<code>0</code>を入力するまで繰り返し実行をするコードになる。</p> <p><code>goto文</code>を使った終了条件付きループと比較してみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>loop<span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> x <span class="token punctuation">;</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>while文</code>の方が圧倒的に書きやすいことがわかる。</p> <h3 id="インデックスループ-2"><a href="008-loop.html#インデックスループ-2" class="header-anchor">#</a> インデックスループ</h3> <p>$n$回<code>&quot;hello\n&quot;s</code>と出力するプログラムを<code>while文</code>で書いてみよう。ただし$n$はユーザーが入力するものとする。</p> <p>まずは<code>goto文</code>でも使ったループ以外の処理をするコードから。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> n <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> n <span class="token punctuation">;</span>
    <span class="token function">hello_n</span><span class="token punctuation">(</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>あとは関数<code>hello_n(n)</code>がインデックスループを実装するだけだ。ただし<code>n</code>が負数ならば何も実行しないようにしよう。</p> <p><code>goto文</code>でインデックスループを書くときに学んだように、</p> <ol><li><code>n &lt; 0</code>ならば関数を終了</li> <li>変数<code>i</code>を作り値を0にする</li> <li><code>i != n</code>ならば繰り返し実行</li> <li>出力</li> <li><code>++i</code></li> <li><code>goto</code> 3.</li></ol> <p>を<code>while文</code>で書くだけだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello_n</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1. n &lt; 0ならば関数を終了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>

    <span class="token comment">// 2. 変数iを作り値を0にする</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>

    <span class="token comment">// 3. i != nならば繰り返し実行</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> i <span class="token operator">!=</span> n <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>   <span class="token comment">// 4. 出力</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token comment">// 5. ++i</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// 6. goto 3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重要な部分だけ抜き出すと以下のとおり。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span><span class="token punctuation">(</span> i <span class="token operator">!=</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token operator">++</span>i <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>goto文</code>を使ったインデックスループと比較してみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>loop <span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">!=</span> n <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>読者の中にはあまり変わらないのではないかと思う人もいるかもしれない。しかし、次の問題を解くプログラムを書くと、<code>while文</code>がいかに楽に書けるかを実感するだろう。</p> <p>問題：以下のような九九の表を出力するプログラムを書きなさい。</p> <div class="language- extra-class"><pre class="language-text"><code>1	2	3	4	5	6	7	8	9	
2	4	6	8	10	12	14	16	18	
3	6	9	12	15	18	21	24	27	
4	8	12	16	20	24	28	32	36	
5	10	15	20	25	30	35	40	45	
6	12	18	24	30	36	42	48	54	
7	14	21	28	35	42	49	56	63	
8	16	24	32	40	48	56	64	72	
9	18	27	36	45	54	63	72	81
</code></pre></div><p>もちろん、このような文字列を愚直に出力しろという問題ではない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 違う！</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;1 2 3 4 5...&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>逐次実行、条件分岐、ループまでを習得した誇りある本物のプログラマーである我々は、もちろん九九の表はループを書いて出力する。</p> <p>まず出力すべき表を見ると、数値が左揃えになっていることに気が付くだろう。</p> <div class="language- extra-class"><pre class="language-text"><code>4	8	12
5	10	15
</code></pre></div><p><code>8</code>は1文字、<code>10</code>は2文字にもかかわらず、<code>12</code>と<code>15</code>は同じ列目から始まっている。これは出力するスペース文字を調整することでも実現できるが、ここでは単にタブ文字を使っている。</p> <p>タブ文字は<code>Makefile</code>を書くのにも使った文字で、C++の文字列中に直接書くこともできるが、エスケープ文字<code>\t</code>を使ってもよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;4\t8\t12\n5\t10\t15&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>エスケープ文字<code>\n</code>が改行文字に置き換わるように、エスケープ文字<code>\t</code>はタブ文字に置き換わる。</p> <p>九九の表はどうやって出力すればよいだろうか。計算自体はC++では<code>&quot;a*b&quot;</code>でできる。上の表がどのように計算されているかを考えてみよう。</p> <div class="language- extra-class"><pre class="language-text"><code>1*1	1*2	1*3	1*4	1*5	1*6	1*7	1*8	1*9	
2*1	2*2	2*3	2*4	2*5	2*6	2*7	2*8	2*9	
3*1	3*2	3*3	3*4	3*5	3*6	3*7	3*8	3*9	
4*1	4*2	4*3	4*4	4*5	4*6	4*7	4*8	4*9	
5*1	5*2	5*3	5*4	5*5	5*6	5*7	5*8	5*9	
6*1	6*2	6*3	6*4	6*5	6*6	6*7	6*8	6*9	
7*1	7*2	7*3	7*4	7*5	7*6	7*7	7*8	7*9	
8*1	8*2	8*3	8*4	8*5	8*6	8*7	8*8	8*9	
9*1	9*2	9*3	9*4	9*5	9*6	9*7	9*8	9*9
</code></pre></div><p>これを見ると、<code>&quot;a*b&quot;</code>のうちの<code>a</code>を<code>1</code>から<code>9</code>までインクリメントし、それに対して<code>b</code>を<code>1</code>から<code>9</code>までインクリメントさせればよい。つまり、9回のインデックスループの中で9回のインデックスループを実行することになる。ループの中のループだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> 条件 <span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> 条件 <span class="token punctuation">)</span>
        文
</code></pre></div><p>さっそくそのようなコードを書いてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1から9まで</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 1から9まで</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span> b <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 計算結果を出力</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">*</span> b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span>
            <span class="token operator">++</span>b <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 段の終わりに改行</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>a <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>うまくいった。</p> <p>ところで、このコードを<code>goto文</code>で書くとどうなるだろうか。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
loop_outer <span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
loop_inner <span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> b <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">*</span> b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span>
            <span class="token operator">++</span>b <span class="token punctuation">;</span>
            <span class="token keyword">goto</span> loop_inner <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>a <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop_outer <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>とてつもなく読みにくい。</p> <h2 id="for文"><a href="008-loop.html#for文" class="header-anchor">#</a> for文</h2> <p>ところでいままで<code>while文</code>で書いてきたインデックスループには特徴がある。</p> <p>試しに1から100までの整数を出力するコードを見てみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; &quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードを読むと、以下のようなパターンがあることがわかる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ループ実行前の変数の宣言と初期化</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token comment">// ループ中の終了条件の確認</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 実際に繰り返したい文</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; &quot;</span>s <span class="token punctuation">;</span>
        <span class="token comment">// 各ループの最後に必ず行う処理</span>
        <span class="token operator">++</span>i <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここで真に必要なのは、「実際に繰り返したい文」だ。その他の処理は、ループを実現するために必要なコードだ。ループの実現に必要な処理が飛び飛びの場所にあるのは、はなはだわかりにくい。</p> <p><code>for文</code>はそのような問題を解決するための機能だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">for</span> <span class="token punctuation">(</span> 変数の宣言 <span class="token punctuation">;</span> 終了条件の確認 <span class="token punctuation">;</span> 各ループの最後に必ず行う処理 <span class="token punctuation">)</span> 文
</code></pre></div><p><code>for文</code>を使うと、上のコードは以下のように書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; &quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>ループの実現に必要な部分だけ抜き出すと以下のようになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// for文の開始</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>
<span class="token comment">// 変数の宣言と初期化</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token comment">// 終了条件の確認</span>
i <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token punctuation">;</span>
<span class="token comment">// 各ループの最後に必ず行う処理</span>
<span class="token operator">++</span>i <span class="token punctuation">)</span>
</code></pre></div><p><code>for文</code>はインデックスループによくあるパターンをわかりやすく書くための機能だ。例えば<code>while文</code>のときに書いた九九の表を出力するプログラムは、<code>for文</code>ならばこんなに簡潔に書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">;</span> <span class="token operator">++</span>a <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> b <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">;</span> <span class="token operator">++</span>b <span class="token punctuation">)</span>
        <span class="token punctuation">{</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a<span class="token operator">*</span>b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span> <span class="token punctuation">}</span>

        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>while文</code>を使ったコードと比べてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span> b <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">*</span> b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span>
            <span class="token operator">++</span>b <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
        <span class="token operator">++</span>a <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>格段に読みやすくなっていることがわかる。</p> <p>C++ではカンマ<code>','</code>を使うことで、複数の<code>式</code>を1つの<code>文</code>に書くことができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token operator">++</span>a<span class="token punctuation">,</span> <span class="token operator">++</span>b <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>for文</code>でもカンマが使える。九九の表を出力するプログラムは、以下のように書くこともできる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">;</span> <span class="token operator">++</span>a<span class="token punctuation">,</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> b <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">;</span> <span class="token operator">++</span>b <span class="token punctuation">)</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a<span class="token operator">*</span>b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>変数もカンマで複数宣言できると知った読者は、以下のように書きたくなるだろう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>   <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>
            a <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token punctuation">;</span>
            <span class="token operator">++</span>a<span class="token punctuation">,</span> <span class="token operator">++</span>b<span class="token punctuation">,</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s
        <span class="token punctuation">)</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> a<span class="token operator">*</span>b <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\t&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは動かない。なぜならば、<code>for文</code>を2つネストさせたループは、$a \times b$回のループで、変数<code>a</code>が<code>1</code>から<code>9</code>まで変化するそれぞれに対して、変数<code>b</code>が<code>1</code>から<code>9</code>まで変化する。しかし、上の<code>for文</code>1つのコードは、変数<code>a</code>, <code>b</code>ともに同時に<code>1</code>から<code>9</code>まで変化する。したがって、これは単に<code>a</code>回のループでしかない。<code>a</code>回のループの中で<code>b</code>回のループをすることで$a \times b$回のループを実現できる。</p> <p><code>for文</code>では使わない部分を省略することができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">bool</span> b <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">;</span>
    <span class="token comment">// for文による変数宣言は使わない</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token punctuation">;</span> b <span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>for文</code>で終了条件を省略した場合、<code>true</code>と同じになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このプログラムは<code>&quot;hello\n&quot;s</code>と無限に出力し続けるプログラムだ。<code>&quot;for(;;)&quot;</code>は<code>&quot;for(;true;)&quot;</code>と同じ意味であり、<code>&quot;while(true)&quot;</code>とも同じ意味だ。</p> <h2 id="do文"><a href="008-loop.html#do文" class="header-anchor">#</a> do文</h2> <p><code>do文</code>は<code>while文</code>に似ている。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">do</span> 文 <span class="token keyword">while</span> <span class="token punctuation">(</span> 条件 <span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>比較のために<code>while文</code>の文法も書いてみると以下のようになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> 条件 <span class="token punctuation">)</span> 文
</code></pre></div><p><code>while文</code>はまず<code>条件</code>を確認し<code>true</code>の場合<code>文</code>を実行する。これを繰り返す。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>do文</code>はまず<code>文</code>を実行する。しかる後に<code>条件</code>を確認し<code>true</code>の場合繰り返しを行う。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span>s <span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>違いがわかっただろうか。<code>do文</code>は繰り返し実行する<code>文</code>を、<code>条件</code>がなんであれ、最初に一度実行する。</p> <p><code>do文</code>を使うと条件にかかわらず文を1回は実行するコードが、文の重複なく書けるようになる。</p> <h2 id="break文"><a href="008-loop.html#break文" class="header-anchor">#</a> break文</h2> <p>ループの実行の途中で、ループの中から外に脱出したくなった場合、どうすればいいのだろうか。例えばループを実行中に何らかのエラーを検出したので処理を中止したい場合などだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 処理</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token comment">// エラーのため脱出したくなった</span>

    <span class="token comment">// 処理</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>break文</code>はループの途中から脱出するための文だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">break</span> <span class="token punctuation">;</span>
</code></pre></div><p><code>break文</code>は<code>for文</code>、<code>while文</code>、<code>do文</code>の中でしか使えない。</p> <p><code>break文</code>は<code>for文</code>、<code>while文</code>、<code>do文</code>の外側に脱出する。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 処理</span>

        <span class="token keyword">break</span> <span class="token punctuation">;</span>

        <span class="token comment">// 処理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは以下のようなコードと同じだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 処理</span>

        <span class="token keyword">goto</span> break_while <span class="token punctuation">;</span>

        <span class="token comment">// 処理</span>
    <span class="token punctuation">}</span>
break_while <span class="token operator">:</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>break文</code>は最も内側の<code>繰り返し文</code>から脱出する</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token comment">// 外側</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token comment">// 内側</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">break</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ここに脱出</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="continue文"><a href="008-loop.html#continue文" class="header-anchor">#</a> continue文</h2> <p>ループの途中で、いまのループを打ち切って次のループに進みたい場合はどうすればいいのだろう。例えば、ループの途中でエラーを検出したので、そのループについては処理を打ち切りたい場合だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 処理</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token comment">// このループは打ち切りたい</span>

    <span class="token comment">// 処理</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>continue文</code>はループを打ち切って次のループに行くための文だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">continue</span> <span class="token punctuation">;</span>
</code></pre></div><p><code>continue文</code>は<code>for文</code>、<code>while文</code>、<code>do</code>文の中でしか使えない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 処理</span>

        <span class="token keyword">continue</span> <span class="token punctuation">;</span>

        <span class="token comment">// 処理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これは以下のようなコードと同じだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 処理</span>

        <span class="token keyword">goto</span> continue_while <span class="token punctuation">;</span>

        <span class="token comment">// 処理</span>

continue_while <span class="token operator">:</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>continue</code>文はループの最後に処理を移す。その結果、次のループを実行するかどうかの<code>条件</code>を評価することになる。</p> <p><code>continue文</code>は最も内側のループに対応する。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token comment">// 外側</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token comment">// 内側</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">continue</span> <span class="token punctuation">;</span>
            <span class="token comment">// continueはここに実行を移す</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="再帰関数"><a href="008-loop.html#再帰関数" class="header-anchor">#</a> 再帰関数</h2> <p>最後に関数でループを実装する方法を示してこの章を終わりにしよう。</p> <p>関数は関数を呼び出すことができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 関数fの呼び出し</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 関数gの呼び出し</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ではもし、関数が自分自身を呼び出したらどうなるだろうか。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span> <span class="token punctuation">;</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>関数<code>main</code>は関数<code>hello</code>を呼び出す</li> <li>関数<code>hello</code>は<code>&quot;hello\n&quot;</code>と出力して関数<code>hello</code>を呼び出す</li></ol> <p>関数<code>hello</code>は必ず関数<code>hello</code>を呼び出すので、この実行は無限ループする。</p> <p>関数が自分自身を呼び出すことを、<code>再帰</code>(recursion)という。</p> <p>なるほど、再帰によって無限ループを実現できることはわかった。では終了条件付きループは書けるだろうか。</p> <p>関数は<code>return文</code>によって呼び出し元に戻る。単に<code>'return ;'</code>と書けば再帰はしない。そして、<code>if文</code>によって実行は分岐できる。これを使えば再帰で終了条件付きループが実現できる。</p> <p>試しに、ユーザーが<code>0</code>を入力するまでループし続けるプログラムを書いてみよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// ユーザーからの入力を返す</span>
<span class="token keyword">int</span> input <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 0の入力を終了条件としたループ</span>
<span class="token keyword">void</span> <span class="token function">loop_until_zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">loop_until_zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">loop_until_zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>書けた。</p> <p>ではインデックスループはどうだろうか。<code>1</code>から<code>10</code>までの整数を出力してみよう。</p> <p>インデックスループを実現するには、書き換えられる変数が必要だ。関数は引数で値を渡すことができる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">g</span><span class="token punctuation">(</span> x<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">f</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>これを見ると、関数<code>main</code>は関数<code>f</code>に引数<code>0</code>を渡し、関数<code>f</code>は関数<code>g</code>に引数<code>1</code>を渡している。これをもっと再帰的に考えよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">until_ten</span><span class="token punctuation">(</span> <span class="token keyword">int</span> x <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span> <span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">until_ten</span><span class="token punctuation">(</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">until_ten</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>関数<code>main</code>は関数<code>until_ten</code>に引数1を渡す。</p> <p>関数<code>until_ten</code>は引数が<code>10</code>より大きければ何もせず処理を戻し、そうでなければ引数を出力して再帰する。そのとき引数は$+1$される。</p> <p>これによりインデックスループが実現できる。</p> <p>関数は戻り値を返すことができる。再帰で戻り値を使うことにより面白い問題も解くことができる。</p> <p>例えば、<code>1</code>と<code>0</code>だけを使った10進数の整数を2進数に変換するプログラムを書いてみよう。</p> <div class="language- extra-class"><pre class="language-text"><code>$ make run
&gt; 0
0
&gt; 1
1
&gt; 10
2
&gt; 11
3
&gt; 1010
10
&gt; 1111
15
</code></pre></div><p>まず10進数と2進数を確認しよう。数学的に言うと「10を底にする」とか「2を底にする」という言い方をする。</p> <p>具体的な例を出すと10進数では1,2,3,4,5,6,7,8,9,0の文字を使う。<code>1234</code>は以下のようになる。</p> <p>$$
1234 = 1 \times 10^3 + 2 \times 10^2 + 3 \times 10^1 + 4 \times 10^0 = 1 \times 1000 + 2 \times 100 + 3 \times 10 + 4 \times 1
$$</p> <p>10進数で<code>1010</code>は以下のようになる。</p> <p>$$
1010 = 1 \times 10^3 + 0 \times 10^2 + 1 \times 10^1 + 0 \times 10^0 = 1 \times 1000 + 0 \times 100 + 1 \times 10 + 0 \times 1
$$</p> <p>2進数では1,0の文字を使う。<code>1010</code>は以下のようになる。</p> <p>$$
1010 = 1 \times 2^3 + 0 \times 2^2 + 1 \times 2^1 + 0 \times 2^0 = 1 \times 8 + 0 \times 4 + 1 \times 2 + 0 \times 1
$$</p> <p>2進数の<code>1010</code>は10進数では<code>10</code>になる。</p> <p>では問題を解いていこう。</p> <p>問題を難しく考えるとかえって解けなくなる。ここではすでに10進数から2進数への変換は解決したものとして考えよう。関数<code>convert</code>によってその問題は解決した。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 2進数への変換</span>
<span class="token keyword">int</span> <span class="token function">convert</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>まだ我々は関数<code>convert</code>の中身を書いていないが、すでに書き終わったと仮定しよう。するとプログラムの残りの部分は以下のように書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">convert</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">// 入力</span>
<span class="token keyword">int</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;&gt; &quot;</span> <span class="token punctuation">;</span>
    <span class="token keyword">int</span> x<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 出力</span>
<span class="token keyword">void</span> <span class="token function">output</span><span class="token punctuation">(</span> <span class="token keyword">int</span> binary <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> binary <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span>s <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 入力、変換、出力のループ</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> decimal <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token keyword">auto</span> binary <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span> decimal <span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token function">output</span><span class="token punctuation">(</span> binary <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>あとは関数<code>convert</code>を実装すればよいだけだ。</p> <p>関数<code>convert</code>に引数を渡したときの結果を考えてみよう。<code>convert(1010)</code>は<code>10</code>を返し、<code>convert(1111)</code>は<code>15</code>を返す。</p> <p>では<code>convert(-1010)</code>の結果はどうなるだろうか。これは<code>-10</code>になる。</p> <p>負数と正数の違いを考えるのは面倒だ。ここでは正数を引数として与えると10進数から2進数へ変換した答えを返してくる魔法のような関数<code>solve</code>をすでに書き終えたと仮定しよう。我々はまだ関数<code>solve</code>を書いていないが、その問題は未来の自分に押し付けよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 1,0のみを使った10進数から</span>
<span class="token comment">// 2進数へ変換する関数</span>
<span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>すると、関数<code>convert</code>がやるのは負数と正数の処理だけでよい。</p> <ol><li>引数が正数の場合はそのまま関数<code>solve</code>に渡して<code>return</code></li> <li>引数が負数の場合は絶対値を関数<code>solve</code>に渡して負数にして<code>return</code></li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">convert</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 引数が正数の場合</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token comment">// そのまま関数solveに渡してreturn</span>
        <span class="token keyword">return</span> <span class="token function">solve</span><span class="token punctuation">(</span> n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token comment">// 引数が負数の場合</span>
        <span class="token comment">// 絶対値を関数solveに渡して負数にしてreturn</span>
        <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token operator">-</span>n <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>n</code>が負数の場合の絶対値は<code>-n</code>で得られる。その場合、関数<code>solve</code>の答えは正数なので負数にする。</p> <p>あとは関数<code>solve</code>を実装するだけだ。</p> <p>今回、引数の整数を10進数で表現した場合に2,3,4,5,6,7,8,9が使われている場合は考えないものとする。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// OK</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">10111101</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token comment">// あり得ない</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>再帰で問題を解くには再帰的な考え方が必要だ。再帰的な考え方では、問題の一部のみを解き、残りは自分自身に丸投げする。</p> <p>まずとても簡単な1桁の変換を考えよう。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><p>引数が<code>0</code>か<code>1</code>の場合、単にその値を返すだけだ。関数<code>solve</code>には正数しか渡されないので、負数は考えなくてよい。すると、以下のように書ける。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> n <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token comment">// その他の場合</span>
<span class="token punctuation">}</span>
</code></pre></div><p>その他の場合とは、桁数が多い場合だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 2</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 3</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 4</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre></div><p>関数<code>solve</code>が解決するのは最下位桁だ。<code>110</code>の場合は<code>0</code>で、<code>111</code>の場合は<code>1</code>となる。最も右側の桁のみを扱う。数値から10進数で表記したときの最下位桁を取り出すには、10で割った余りが使える。覚えているだろうか。剰余演算子の<code>operator %</code>を。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> n <span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token comment">// 未完成</span>
        <span class="token keyword">return</span> n<span class="token operator">%</span><span class="token number">10</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>結果は以下のようになる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 0</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// 1</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><p>これで関数<code>solve</code>は最下位桁に完全に対応した。しかしそれ以外の桁はどうすればいいのだろう。</p> <p>ここで再帰的な考え方が必要だ。関数<code>solve</code>はすでに最下位桁に完全に対応している。ならば次の桁を最下位桁とした数値で関数<code>solve</code>を再帰的に呼び出せばいいのではないか。</p> <p>以下は<code>solve(n)</code>が再帰的に呼び出す関数だ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// solve(1)</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>  <span class="token comment">// solve(1)</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// solve(10)→solve(1)</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// solve(11)→solve(1)</span>
<span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// solve(11)→solve(1)</span>
</code></pre></div><p>10進数表記された数値から最下位桁を取り除いた数値にするというのは、11を1に,
111を11にする処理だ。これは数値を10で割ればよい。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token number">10</span>  <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token number">11</span>  <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token number">100</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">;</span> <span class="token comment">// 10</span>
<span class="token number">110</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">;</span> <span class="token comment">// 11</span>
<span class="token number">111</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">;</span> <span class="token comment">// 11</span>
</code></pre></div><p>10進数表記は桁が1つ上がると10倍される。だから10で割れば最下位桁が消える。ところで、我々は計算しようとしているのは2進数だ。2進数では桁が1つ上がると2倍される。なので、再帰的に関数<code>solve</code>を呼び出して得られた結果は2倍しなければならない。そして足し合わせる。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1桁の場合</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> n <span class="token punctuation">;</span> <span class="token comment">// 単に返す</span>
    <span class="token keyword">else</span> <span class="token comment">// それ以外</span>
        <span class="token keyword">return</span>
            <span class="token comment">// 最下位桁の計算</span>
            n<span class="token operator">%</span><span class="token number">10</span>
            <span class="token comment">// 残りの桁を丸投げする</span>
            <span class="token comment">// 次の桁なので2倍する</span>
            <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">solve</span><span class="token punctuation">(</span> n<span class="token operator">/</span><span class="token number">10</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>冗長なコメントを除いて短くすると以下のとおり。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> n <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> n<span class="token operator">%</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">solve</span><span class="token punctuation">(</span> n<span class="token operator">/</span><span class="token number">10</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再帰ではないループで関数<code>solve</code>を実装するとどうなるのだろうか。</p> <p>引数の数値が何桁あっても対応できるよう、ループで1桁ずつ処理していくのは変わらない。</p> <p>もう一度2進数の計算を見てみよう。</p> <p>$$
1010 = 1 \times 2^3 + 0 \times 2^2 + 1 \times 2^1 + 0 \times 2^0 = 1 \times 8 + 0 \times 4 + 1 \times 2 + 0 \times 1
$$</p> <p>1桁目は0で、この値は$0 \times 2^0$、2桁目は1で、この値は$1 \times 2^1$になる。</p> <p>一般に、$i$桁目の値は$i桁目の数字 \times 2^{i-1}$になる。</p> <p>すると解き方としては、各桁の値を計算した和を返せばよい</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">solve</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 和</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token comment">// i桁目の数字に乗ずる値</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span>

    <span class="token comment">// 桁がなくなれば終了</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> n <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 現在の桁を計算して足す</span>
        result <span class="token operator">+=</span> n<span class="token operator">%</span><span class="token number">10</span> <span class="token operator">*</span> i <span class="token punctuation">;</span>
        <span class="token comment">// 次の桁に乗ずる値</span>
        i <span class="token operator">*=</span> <span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token comment">// 桁を1つ減らす</span>
        n <span class="token operator">/=</span> <span class="token number">10</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再帰を使うコードは、再帰を理解できれば短く簡潔でわかりやすい。ただし、再帰を理解するためにはまず再帰を理解しなければならない。</p> <p>再帰は万能ではない。そもそも関数とは、別の関数から呼ばれるものだ。関数<code>main</code>だけは特別で、関数<code>main</code>を呼び出すことはできない。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment">// エラー</span>
<span class="token punctuation">}</span>
</code></pre></div><p>関数の実行が終了した場合、呼び出し元に処理が戻る。そのために関数は呼び出し元を覚えていなければならない。これには通常<code>スタック</code>と呼ばれるメモリーを消費する。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>            <span class="token comment">// gに戻る</span>
<span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// mainに戻る </span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>関数の中の変数も通常<code>スタック</code>に確保される。これもメモリーを消費する。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x <span class="token punctuation">;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>   <span class="token comment">// 関数を呼び出す</span>
    <span class="token comment">// 関数を呼び出したあとに変数を使う</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> x <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>このコードでは、関数<code>g</code>が変数<code>x</code>を用意し、関数<code>f</code>を呼び出し、処理が戻ったら変数<code>x</code>を使っている。このコードが動くためには、変数<code>x</code>は関数<code>f</code>が実行されている間もスタックメモリーを消費し続けなければならない。</p> <p>スタックメモリーは有限であるので、以下のような再帰による無限ループは、いつかスタックメモリーを消費し尽して実行が止まるはずだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;hello\n&quot;</span> <span class="token punctuation">;</span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>しかし、大半の読者の環境ではプログラムの実行が止まらないはずだ。これはコンパイラーの末尾再帰の最適化によるものだ。</p> <p>末尾再帰とは、関数のすべての条件分岐の末尾が再帰で終わっている再帰のことだ。</p> <p>例えば以下は階乗を計算する再帰で書かれたループだ。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>factorial(n)</code>は$1 \times 2 \times 3 \times ... \times n$を計算する。</p> <p>この関数は、引数<code>n</code>が<code>1</code>未満であれば引数が間違っているので<code>0</code>を返す。そうでない場合で<code>n</code>が<code>1</code>であれば<code>1</code>を返す。それ以外の場合、<code>n * factorial(n-1)</code>を返す。</p> <p>このコードは末尾再帰になっている。末尾再帰は非再帰のループに機械的に変換できる特徴を持っている。例えば以下のように、</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span> <span class="token keyword">int</span> n <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> temp <span class="token operator">=</span> n <span class="token punctuation">;</span>

loop <span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> n <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">return</span> temp <span class="token operator">*</span> <span class="token number">1</span> <span class="token punctuation">;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        n <span class="token operator">=</span> n<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">;</span>
        temp <span class="token operator">*=</span> n <span class="token punctuation">;</span>
        <span class="token keyword">goto</span> loop <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>関数のすべての条件分岐の末尾が再帰になっているため、機械的に関数呼び出しを<code>goto</code>文で置き換えることができる。</p> <p>ただし、プログラミング言語C++の標準規格は、C++の実装に末尾再帰の最適化を義務付けてはいない。そのため、末尾再帰が最適化されるかどうかはC++コンパイラー次第だ。</p> <p>再帰は強力なループの実現方法で、再帰的な問題を解くのに最適だが、落とし穴もある。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="007-standard-input.html" class="prev">最近体重が気になるあなたのための標準入力</a></span> <span class="next"><a href="009-vector.html">メモリーを無限に確保する</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="assets/js/app.8620998f.js" defer></script><script src="assets/js/2.7009e9ba.js" defer></script><script src="assets/js/13.85764695.js" defer></script>
  </body>
</html>
